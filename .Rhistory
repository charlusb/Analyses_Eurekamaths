                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                                
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1 & number_lessons!=0)                                                                                                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
################################################ centering numerical variables                                                                                                                             
                                                                                                                                                                                                           
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
                                                                                                                                                                                                           
insight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
                                                                                                                                                                                                           
confidence$number_lessons_n <- scale(confidence$number_lessons, center=TRUE, scale=FALSE)                                                                                                                  
confidence$math_edu_n <- scale(confidence$math_edu, center=TRUE, scale=FALSE)                                                                                                                              
confidence$confidence_n <- scale(confidence$confidence, center=TRUE, scale=FALSE)                                                                                                                          
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
lessons_perf <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                         
lessons_perf                                                                                                                                                                                               
                                                                                                                                                                                                           
### Exploring the interaction between test condition and number of lessons: Linear trends by number of lessons in each test condition                                                                      
                                                                                                                                                                                                           
perf_trends <- emtrends(lessons_perf,var="number_lessons_n",specs=c("test_condition"))                                                                                                                     
summary(perf_trends,infer=TRUE,null=0, adjust="holm")                                                                                                                                                      
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
insight_perf$insight <- as.factor(insight_perf$insight)                                                                                                                                                    
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
confmeaninsight$insight <- as.factor(confmeaninsight$insight)                                                                                                                                              
                                                                                                                                                                                                           
perf_ins <- mixed(acc~insight*test_condition+ (1|participant), data=insight_perf,family=binomial,check_contrasts=TRUE,method="LRT")                                                                        
perf_ins                                                                                                                                                                                                   
                                                                                                                                                                                                           
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on accuracy by test condition                                                                        
                                                                                                                                                                                                           
contrast(emmeans(perf_ins,~insight|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight"),adjust="holm")                                                                           
confint(contrast(emmeans(perf_ins,~insight|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight"),adjust="holm"))                                                                  
                                                                                                                                                                                                           
                                                                                                                                                                                                           
###############with covariates for Math edu  and Number of lessons  ####################################################################                                                                   
                                                                                                                                                                                                           
perf_ins_cov <- mixed(acc~test_condition*number_lessons_n+test_condition*insight+math_edu_n*test_condition +(1|participant), data=insight_perf,family=binomial,check_contrasts=T,method="LRT")             
summary(perf_ins_cov)                                                                                                                                                                                      
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_ins_cov,~insight|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight"), adjust="holm")                                                                      
confint(contrast(emmeans(perf_ins_cov,~insight|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight"), adjust="holm"))                                                             
perf_ins_cov
perf_confs <- mixed(acc~test_condition*insight + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,check_contrasts=T,method="LRT")                                         
summary(perf_confs)                                                                                                                                                                                        
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                                         
confint(contrast(emmeans(perf_confs,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm"))                                                                
                                                                                                                                                                                                           
### Effect of confidence (linear trends) on accuracy in each test condition                                                                                                                                
                                                                                                                                                                                                           
conf_trends <- emtrends(perf_confs,var="confidence_n",specs=c("test_condition"))                                                                                                                           
summary(conf_trends,infer=TRUE,null=0, adjust="holm")                                                                                                                                                      
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
############ With covariates for Math edu  and Number of lessons #########################################################                                                                                 
                                                                                                                                                                                                           
perf_confs_cov <- mixed(acc~test_condition*number_lessons_n+test_condition*insight+math_edu_n*test_condition + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,          
check_contrasts=T,method="LRT")                                                                                                                                                                            
summary(perf_confs_cov)                                                                                                                                                                                    
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                     
confint(contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight"), combine=T, adjust="holm"))                                            
                                                                                                                                                                                                           
### Effect of confidence (linear trends) on accuracy in each  test condition                                                                                                                               
                                                                                                                                                                                                           
conf_trends_cov <- emtrends(perf_confs_cov,var="confidence_n",specs=c("test_condition"))                                                                                                                   
summary(conf_trends_cov,infer=T,null=0, adjust="holm")                                                                                                                                                     
                                                                                                                                                                                                           
                                                                                                                                                                                                           
perf_confs_cov
quit()
lessons_perf
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
####### esthetic functions                                                                                                                                                                                 
                                                                                                                                                                                                           
mycolors=function(ggobject){                                                                                                                                                                               
                                                                                                                                                                                                           
ggobject+                                                                                                                                                                                                  
scale_color_manual(values = c("#9AE39A", "#E7B800", "#CC0066", "#FF6666", "#9999FF", "#D16103","#FFDB6D" ))                                                                                                
                                                                                                                                                                                                           
}                                                                                                                                                                                                          
                                                                                                                                                                                                           
themetiny=function(ggobject){                                                                                                                                                                              
                                                                                                                                                                                                           
ggobject+                                                                                                                                                                                                  
theme(plot.title = element_text(face="bold",size=14,hjust = 0.5))+                                                                                                                                         
theme(axis.text=element_text(size=9,face="bold"),                                                                                                                                                          
axis.title=element_text(size=10,face="bold"),                                                                                                                                                              
legend.text=element_text(size=10))                                                                                                                                                                         
}                                                                                                                                                                                                          
                                                                                                                                                                                                           
summary(tests)
lessons_perf
## No need to set level of math edu here, emmeans already sets at mean level in  model                                                                                                                     
predictions <- data.frame(emmeans(lessons_perf,specs=c("number_lessons_n","test_condition"), cov.reduce=F, type="response"))                                                                               
                                                                                                                                                                                                           
predictions$test_condition= factor(predictions$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                     
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar', 'Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                          
predictions=predictions[order(predictions$test_condition),]                                                                                                                                                
all_plot=aggregate(acc~participant+number_lessons_n+test_condition+math_edu_n, data=tests, FUN=mean)                                                                                                       
all_plot$acclogit=logit(all_plot$acc, adjust=0.01)                                                                                                                                                         
all_plot$acclogitcor=all_plot$acclogit-((all_plot$math_edu-3.9)*(summary(lessons_perf)$coefficients[11,1]))                                                                                                
all_plot$coeffniv[all_plot$test_condition=="Test1_non_circles"]=0                                                                                                                                          
all_plot$coeffniv[all_plot$test_condition=="Test1_great_circles"]=summary(lessons_perf)$coefficients[20,1]                                                                                                 
all_plot$coeffniv[all_plot$test_condition=="Test1_small_circles"]=summary(lessons_perf)$coefficients[21,1]                                                                                                 
all_plot$coeffniv[all_plot$test_condition=="Test2_nonstraight_nonplanar"]=summary(lessons_perf)$coefficients[22,1]                                                                                         
all_plot$coeffniv[all_plot$test_condition=="Test2_nonstraight_planar"]=summary(lessons_perf)$coefficients[23,1]                                                                                            
all_plot$coeffniv[all_plot$test_condition=="Test2_straight_nonplanar"]=summary(lessons_perf)$coefficients[24,1]                                                                                            
all_plot$coeffniv[all_plot$test_condition=="Test2_straight_planar"]=summary(lessons_perf)$coefficients[25,1]                                                                                               
all_plot$coeffniv[all_plot$test_condition=="Test3_sphere"]=summary(lessons_perf)$coefficients[27,1]                                                                                                        
all_plot$coeffniv[all_plot$test_condition=="Test3_other_surfaces"]=summary(lessons_perf)$coefficients[26,1]                                                                                                
all_plot$acclogitcor=all_plot$acclogitcor-((all_plot$math_edu-3.9)*all_plot$coeffniv)                                                                                                                      
all_plot$acclogitcor=exp(all_plot$acclogitcor)/(1+exp(all_plot$acclogitcor))                                                                                                                               
                                                                                                                                                                                                           
                                                                                                                                                                                                           
all_plot$test_condition= factor(all_plot$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                           
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar','Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                           
all_plot=all_plot[order(all_plot$test_condition),]                                                                                                                                                         
                                                                                                                                                                                                           
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                   
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons)),size=0.8)+                                                                                                                 
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons)))+                                                                                                                                                    
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))                                                                                                                                
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
                                                                                                                                                                                                           
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))                                                                                                                                
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
ggsave("number_lessons_on_perf_test1_newplot.pdf")                                                                                                                                                         
quit()
lessons_perf_p <- mixed(acc~number_lessons*test_condition+math_edu*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                           
lessons_perf_p                                                                                                                                                                                             
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                          
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                                
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1 & number_lessons!=0)                                                                                                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
                                                                                                                                                                                                           
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
                                                                                                                                                                                                           
insight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
                                                                                                                                                                                                           
confidence$number_lessons_n <- scale(confidence$number_lessons, center=TRUE, scale=FALSE)                                                                                                                  
confidence$math_edu_n <- scale(confidence$math_edu, center=TRUE, scale=FALSE)                                                                                                                              
confidence$confidence_n <- scale(confidence$confidence, center=TRUE, scale=FALSE)                                                                                                                          
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
                                                                                                                                                                                                           
lessons_perf
lessons_perf_p <- mixed(acc~number_lessons*test_condition+math_edu*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                           
lessons_perf_p                                                                                                                                                                                             
quit()
                                                                              
                                                                                
                                                                                
library(afex)                                                                   
library(emmeans)                                                                
library(ppcor)                                                                  
library(car)                                                                    
library(ggplot2)                                                                
library(reshape2)                                                               
                                                                                                                                                                                                           
perf_ins_bef <- mixed(acc~insight_bef*test_condition+ (1|participant), data=prev_ins,family=binomial,check_contrasts=T,method="LRT")                                                                       
perf_ins_bef                                                                                                                                                                                               
                                                                                                                                                                                                           
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on accuracy by test condition                                                                        
                                                                                                                                                                                                           
contrast(emmeans(perf_ins_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"),adjust="holm")                                                               
confint(contrast(emmeans(perf_ins_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"),adjust="holm"))                                                      
                                                                                                                                                                                                           
                                                                                                                                                                                                           
###############with covariates for Math edu  and Number of lessons  ####################################################################                                                                   
                                                                                                                                                                                                           
perf_ins_cov_bef <- mixed(acc~test_condition*number_lessons_n+test_condition*insight_bef+math_edu_n*test_condition +(1|participant), data=prev_ins,family=binomial,check_contrasts=T,method="LRT")         
perf_ins_cov_bef                                                                                                                                                                                           
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm")                                                          
confint(contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm"))                                                 
                                                                                                                                                                                                           
perf_confs_bef <- mixed(acc~test_condition*insight_bef + confidence_n*test_condition+(1|participant), data=confmeaninsight_bef,family=binomial,check_contrasts=T,method="LRT")                             
perf_confs_bef                                                                                                                                                                                             
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                                             
confint(contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                                    
                                                                                                                                                                                                           
### Effect of confidence (linear trends) on accuracy in each test condition                                                                                                                                
                                                                                                                                                                                                           
conf_trends_bef <- emtrends(perf_confs_bef,var="confidence_n",specs=c("test_condition"))                                                                                                                   
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm")                                                                                                                                                  
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
############ with covariates for Math edu  and Number of lessons #########################################################                                                                                 
                                                                                                                                                                                                           
perf_confs_cov_bef <- mixed(acc~test_condition*number_lessons_n+test_condition*insight_bef+math_edu_n*test_condition + confidence_n*test_condition+(1|participant),                                        
data=confmeaninsight_bef,family=binomial, check_contrasts=T,method="LRT")                                                                                                                                  
perf_confs_cov_bef                                                                                                                                                                                         
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                         
confint(contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                
                                                                                                                                                                                                           
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
ls()
perf_confs_cov_0
summary(tests)
5-3.92
                                                                                                                                                                                                           
mycolors=function(ggobject){                                                                                                                                                                               
                                                                                                                                                                                                           
ggobject+                                                                                                                                                                                                  
scale_color_manual(values = c("#9AE39A", "#E7B800", "#CC0066", "#FF6666", "#9999FF", "#D16103","#FFDB6D" ))                                                                                                
                                                                                                                                                                                                           
}                                                                                                                                                                                                          
                                                                                                                                                                                                           
themetiny=function(ggobject){                                                                                                                                                                              
                                                                                                                                                                                                           
ggobject+                                                                                                                                                                                                  
theme(plot.title = element_text(face="bold",size=14,hjust = 0.5))+                                                                                                                                         
theme(axis.text=element_text(size=9,face="bold"),                                                                                                                                                          
axis.title=element_text(size=10,face="bold"),                                                                                                                                                              
legend.text=element_text(size=10))                                                                                                                                                                         
}                                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
###### Effect of number of lessons on performance  ###############                                                                                                                                         
####### predictions of model + individual performance corrected for math edu                                                                                                                               
predictions <- data.frame(emmeans(lessons_perf,specs=c("number_lessons_n","test_condition"), cov.reduce=F, type="response"))                                                                               
                                                                                                                                                                                                           
predictions$test_condition= factor(predictions$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                     
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar', 'Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                          
predictions=predictions[order(predictions$test_condition),]                                                                                                                                                
all_plot=aggregate(acc~participant+number_lessons_n+test_condition+math_edu_n, data=tests, FUN=mean)                                                                                                       
all_plot$acclogit=logit(all_plot$acc, adjust=0.01)                                                                                                                                                         
all_plot$acclogitcor=all_plot$acclogit-((all_plot$math_edu-3.9)*(summary(lessons_perf)$coefficients[11,1]))                                                                                                
all_plot$coeffniv[all_plot$test_condition=="Test1_non_circles"]=0                                                                                                                                          
all_plot$coeffniv[all_plot$test_condition=="Test1_great_circles"]=summary(lessons_perf)$coefficients[20,1]                                                                                                 
all_plot$coeffniv[all_plot$test_condition=="Test1_small_circles"]=summary(lessons_perf)$coefficients[21,1]                                                                                                 
all_plot$coeffniv[all_plot$test_condition=="Test2_nonstraight_nonplanar"]=summary(lessons_perf)$coefficients[22,1]                                                                                         
all_plot$coeffniv[all_plot$test_condition=="Test2_nonstraight_planar"]=summary(lessons_perf)$coefficients[23,1]                                                                                            
all_plot$coeffniv[all_plot$test_condition=="Test2_straight_nonplanar"]=summary(lessons_perf)$coefficients[24,1]                                                                                            
all_plot$coeffniv[all_plot$test_condition=="Test2_straight_planar"]=summary(lessons_perf)$coefficients[25,1]                                                                                               
all_plot$coeffniv[all_plot$test_condition=="Test3_sphere"]=summary(lessons_perf)$coefficients[27,1]                                                                                                        
all_plot$coeffniv[all_plot$test_condition=="Test3_other_surfaces"]=summary(lessons_perf)$coefficients[26,1]                                                                                                
all_plot$acclogitcor=all_plot$acclogitcor-((all_plot$math_edu-3.9)*all_plot$coeffniv)                                                                                                                      
all_plot$acclogitcor=exp(all_plot$acclogitcor)/(1+exp(all_plot$acclogitcor))                                                                                                                               
                                                                                                                                                                                                           
                                                                                                                                                                                                           
all_plot$test_condition= factor(all_plot$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                           
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar','Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                           
all_plot=all_plot[order(all_plot$test_condition),]                                                                                                                                                         
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))                                                                                                                                
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(-3,-1,0,1),limits=c("1","", "3", "","5", "","7"))                                                                                                                              
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
# scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))                                                                                                                                
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("-3","", "-1", "","1", "","3"))                                                                                                                              
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("-4","", "-1", "","1", ""))                                                                                                                                  
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
                                                                                                                                                                                                           
condtest2 = c("Test2_nonstraight_nonplanar","Test2_straight_planar","Test2_nonstraight_planar","Test2_straight_nonplanar")                                                                                 
perf_test2 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest2))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest2),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid( . ~ test_condition)+                                                                                                                                                                         
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))                                                                                                                                
perf_test2 <- perf_test2 + ggtitle("Effect of number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                                 
perf_test2 <- perf_test2 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test2 <-mycolors(perf_test2)                                                                                                                                                                          
perf_test2 <-themetiny(perf_test2)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test2                                                                                                                                                                                                 
                                                                                                                                                                                                           
perf_test3 <- perf_test3 + ggtitle("Effect of number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                                 
perf_test3 <- perf_test3 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test3 <-mycolors(perf_test3)                                                                                                                                                                          
perf_test3 <-themetiny(perf_test3)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test3                                                                                                                                                                                                 
summary(lessons_perf)$coefficients
quit()
                                                                                                                                                                                                           
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
summary(conf)
                                                                                                                                                                                                           
####### esthetic functions                                                                                                                                                                                 
                                                                                                                                                                                                           
mycolors=function(ggobject){                                                                                                                                                                               
                                                                                                                                                                                                           
ggobject+                                                                                                                                                                                                  
scale_color_manual(values = c("#9AE39A", "#E7B800", "#CC0066", "#FF6666", "#9999FF", "#D16103","#FFDB6D" ))                                                                                                
                                                                                                                                                                                                           
}                                                                                                                                                                                                          
                                                                                                                                                                                                           
themetiny=function(ggobject){                                                                                                                                                                              
                                                                                                                                                                                                           
ggobject+                                                                                                                                                                                                  
theme(plot.title = element_text(face="bold",size=14,hjust = 0.5))+                                                                                                                                         
theme(axis.text=element_text(size=9,face="bold"),                                                                                                                                                          
axis.title=element_text(size=10,face="bold"),                                                                                                                                                              
legend.text=element_text(size=10))                                                                                                                                                                         
}                                                                                                                                                                                                          
                                                                                                                                                                                                           
## No need to set level of math edu here, emmeans already sets at mean level in  model                                                                                                                     
predictions <- data.frame(emmeans(lessons_perf,specs=c("number_lessons_n","test_condition"), cov.reduce=F, type="response"))                                                                               
summary(predictions)
predictions$test_condition= factor(predictions$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                     
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar', 'Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                          
predictions=predictions[order(predictions$test_condition),]                                                                                                                                                
all_plot=aggregate(acc~participant+number_lessons_n+test_condition+math_edu_n, data=tests, FUN=mean)                                                                                                       
head(all_plot)
all_plot$acclogit=logit(all_plot$acc, adjust=0.01) 
head(all_plot)
log(1)
log(4.59)
summary(lessons_perf)$coefficients
summary(lessons_perf)$coefficients[11,1]
lessons_perf_old <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                     
lessons_perf_old <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=F,method="LRT")                                     
quit()
