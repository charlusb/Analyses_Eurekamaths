insac                                                                                                                                                                                                      
                                                                                                                                                                                                           
ggsave("insight_Test2_straight_nonplanar.pdf")                                                                                                                                                             
                                                                                                                                                                                                           
                                                                                                                                                                                                           
ins <- ggplot(aes(x=number_lessons,y=prob),data=predict_insight)+                                                                                                                                          
  geom_point(data=ins_plot,aes(y=inscor),color="grey50",alpha=1/5, size=3,position=position_jitter(w=0.3,h=0))+                                                                                            
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons)),size=0.8)+                                                                                                                 
  geom_line(size=0.8)+                                                                                                                                                                                     
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))+                                                                                                                               
  geom_point(size=3,aes(color=factor(number_lessons)))+                                                                                                                                                    
  theme_classic()                                                                                                                                                                                          
ins <- ins + ggtitle("Effect of number of lessons on insight report") + xlab("Number of lessons")+ylab("% insight reports")                                                                                
ins <- ins + guides(color=guide_legend("Number of lessons"))                                                                                                                                               
ins <- ins + theme(plot.title = element_text(face="bold",size=15,hjust = 0.5))                                                                                                                             
ins <- themetiny(ins)                                                                                                                                                                                      
ins <-mycolors(ins)                                                                                                                                                                                        
dev.new(width=7,height=4)                                                                                                                                                                                  
ins                                                                                                                                                                                                        
                                                                                                                                                                                                           
ggsave("Numb_lessons_eff_on_Insight.pdf")                                                                                                                                                                  
                                                                                                                                                                                                           
ins_plot <- aggregate(insight~participant+number_lessons+math_edu, data=insight_bin, FUN=mean)                                                                                                             
ins_plot$inslogit <- logit(ins_plot$insight, adjust=0.01)                                                                                                                                                  
ins_plot$inscor <- ins_plot$inslogit-((ins_plot$math_edu-3.9)*summary(insight_lessons)$coefficients[3,1])                                                                                                  
ins_plot$inscor <- exp(ins_plot$inscor)/(1+exp(ins_plot$inscor))                                                                                                                                           
                                                                                                                                                                                                           
## No need to set level of math edu here, emmeans already set at mean level in  model                                                                                                                      
insight <- emmeans(insight_lessons,specs="number_lessons", cov.reduce=F,type="response")                                                                                                                   
predict_insight <- data.frame(summary(insight))                                                                                                                                                            
                                                                                                                                                                                                           
                                                                                                                                                                                                           
ins <- ggplot(aes(x=number_lessons,y=prob),data=predict_insight)+                                                                                                                                          
  geom_point(data=ins_plot,aes(y=inscor),color="grey50",alpha=1/5, size=3,position=position_jitter(w=0.3,h=0))+                                                                                            
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons)),size=0.8)+                                                                                                                 
  geom_line(size=0.8)+                                                                                                                                                                                     
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))+                                                                                                                               
  geom_point(size=3,aes(color=factor(number_lessons)))+                                                                                                                                                    
  theme_classic()                                                                                                                                                                                          
ins <- ins + ggtitle("Effect of number of lessons on insight report") + xlab("Number of lessons")+ylab("% insight reports")                                                                                
ins <- ins + guides(color=guide_legend("Number of lessons"))                                                                                                                                               
ins <- ins + theme(plot.title = element_text(face="bold",size=15,hjust = 0.5))                                                                                                                             
ins <- themetiny(ins)                                                                                                                                                                                      
ins <-mycolors(ins)                                                                                                                                                                                        
dev.new(width=7,height=4)                                                                                                                                                                                  
ins                                                                                                                                                                                                        
                                                                                                                                                                                                           
ggsave("Numb_lessons_eff_on_Insight.pdf")                                                                                                                                                                  
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number_lessons!=0)                                                                                                                                                    
tests$test_condition <- relevel(as.factor(tests$test_condition), ref="Test1_non_circles")                                                                                                                  
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
                                                                                                                                                                                                           
insight_lessons <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                    
  insight_lessons <- glm(insight~number_lessons+math_edu, data=insight_bin,family=binomial)                                                                                                                  
Anova(insight_lessons, type="III")                                                                                                                                                                         
insight_teach <- subset(insight_teach, included==1)                                                                                                                                                        insight_teach
insight_teach <- subset(insight_teach, included==1)   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1)                                                                                                                                                        
mean(insight_teach$ins_lessons)
nrow(insight_teach)
insight_lessons <- glm(insight~number_lessons+math_edu, data=insight_bin,family=binomial)                                                                                                                  
Anova(insight_lessons, type="III")                                                                                                                                                                         
insight_main <- glm(insight~number_lessons+math_edu, data=insight_teach,family=binomial)                                                                                                                   
Anova(insight_main, type="III")                                                                                                                                                                            
                                                                                                                                                                                                           
insight_main <- glm(ins_lessons~number_lessons+math_edu, data=insight_teach,family=binomial)                                                                                                               
Anova(insight_main, type="III")                                                                                                                                                                            
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf_2 <- merge(tests,insight_teach)                                                                                                                                                               
confmeaninsight_2 <- merge(conf_perf, insight_teach)                                                                                                                                                       
perf_ins_2 <- mixed(acc~ins_lessons*test_condition+ (1|participant), data=insight_perf_2,family=binomial,check_contrasts=FALSE,method="LRT")                                                               
perf_ins_2                                                                                                                                                                                                 
contrast(emmeans(perf_ins_2,~ins_lessons|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("ins_lessons"),adjust="holm")                                                                 
perf_ins_cov_2 <- mixed(acc~test_condition*number_lessons+test_condition*ins_lessons+math_edu*test_condition +(1|participant), data=insight_perf_2,family=binomial,check_contrasts=F,method="LRT")         
perf_ins_cov_2                                                                                                                                                                                             
perf_ins_cov_2
contrast(emmeans(perf_ins_cov_2,~ins_lessons|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("ins_lessons"), adjust="holm")                                                            
confcol<-dcast(participant+included+number_lessons+math_edu~measurement,value.var="confidence",data=confidence)                                                                                            
confinsight_2 <- merge(confcol,insight_teach)                                                                                                                                                              
confinsight2_2=subset(confinsight, Pos3!="NA")                                                                                                                                                             
cor.test(~Pos1+Pos2,data=confinsight_2, method="spearman")                                                                                                                                                 
cor.test(~Pos1+Pos3,data=confinsight2_2, method="spearman")                                                                                                                                                
cor.test(~Pos2+Pos3,data=confinsight2_2, method="spearman")                                                                                                                                                
cor.test(~Pos1+insight,data=confinsight_2, method="spearman")                                                                                                                                              
cor.test(~Pos2+insight,data=confinsight_2, method="spearman")                                                                                                                                              
cor.test(~Pos3+insight,data=confinsight2_2, method="spearman")                                                                                                                                             
cor.test(~Pos1+ins_lessons,data=confinsight_2, method="spearman")                                                                                                                                          
cor.test(~Pos2+ins_lessons,data=confinsight_2, method="spearman")                                                                                                                                          
cor.test(~Pos3+ins_lessons,data=confinsight2_2, method="spearman")                                                                                                                                         
head(confinsight2_2)
confinsight_2 <- merge(confcol,insight_teach)                                                                                                                                                              
confinsight2_2=subset(confinsight_2, Pos3!="NA")                                                                                                                                                           
                                                                                                                                                                                                           
### simple correlations between each confidence measure and insight                                                                                                                                        
### not the same nb of df : one missing data point for conf 3                                                                                                                                              
cor.test(~Pos1+Pos2,data=confinsight_2, method="spearman")                                                                                                                                                 
cor.test(~Pos1+Pos3,data=confinsight2_2, method="spearman")                                                                                                                                                
cor.test(~Pos2+Pos3,data=confinsight2_2, method="spearman")                                                                                                                                                
cor.test(~Pos1+ins_lessons,data=confinsight_2, method="spearman")                                                                                                                                          
cor.test(~Pos2+ins_lessons,data=confinsight_2, method="spearman")                                                                                                                                          
cor.test(~Pos3+ins_lessons,data=confinsight2_2, method="spearman")                                                                                                                                         
### p values corrected with holm                                                                                                                                                                           
cory <- cbind(                                                                                                                                                                                             
cor.test(~Pos1+Pos2,data=confinsight_2, method="spearman"),                                                                                                                                                
cor.test(~Pos1+Pos3,data=confinsight2_2, method="spearman"),                                                                                                                                               
cor.test(~Pos2+Pos3,data=confinsight2_2, method="spearman"),                                                                                                                                               
cor.test(~Pos1+insight,data=confinsight_2, method="spearman"),                                                                                                                                             
cor.test(~Pos2+insight,data=confinsight_2, method="spearman"),                                                                                                                                             
cor.test(~Pos3+insight,data=confinsight2_2, method="spearman"))                                                                                                                                            
format(p.adjust(cory[3,], method="holm"),scientific=F)                                                                                                                                                     
cory <- cbind(                                                                                                                                                                                             
cor.test(~Pos1+Pos2,data=confinsight_2, method="spearman"),                                                                                                                                                
cor.test(~Pos1+Pos3,data=confinsight2_2, method="spearman"),                                                                                                                                               
cor.test(~Pos2+Pos3,data=confinsight2_2, method="spearman"),                                                                                                                                               
cor.test(~Pos1+ins_lessons,data=confinsight_2, method="spearman"),                                                                                                                                         
cor.test(~Pos2+ins_lessons,data=confinsight_2, method="spearman"),                                                                                                                                         
cor.test(~Pos3+ins_lessons,data=confinsight2_2, method="spearman"))                                                                                                                                        
format(p.adjust(cory[3,], method="holm"),scientific=F)                                                                                                                                                     
pcor.test(confinsight$Pos1, confinsight$Pos2,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")                                                                                   
pcor.test(confinsight2$Pos1, confinsight2$Pos3,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")                                                                               
pcor.test(confinsight2$Pos2, confinsight2$Pos3,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")                                                                               
pcor.test(confinsight$Pos1, confinsight$ins_lessons,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")                                                                            
pcor.test(confinsight$Pos2, confinsight$ins_lessons,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")                                                                            
pcor.test(confinsight2$Pos3, confinsight2$ins_lessons,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")                                                                        
pcor.test(confinsight_2$Pos1, confinsight_2$Pos2,list( confinsight_2$math_edu, confinsight_2$number_lessons), method="spearman")                                                                           
pcor.test(confinsight2_2$Pos1, confinsight2_2$Pos3,list( confinsight2_2$math_edu, confinsight2_2$number_lessons), method="spearman")                                                                       
pcor.test(confinsight2_2$Pos2, confinsight2_2$Pos3,list( confinsight2_2$math_edu, confinsight2_2$number_lessons), method="spearman")                                                                       
pcor.test(confinsight_2$Pos1, confinsight_2$ins_lessons,list( confinsight_2$math_edu, confinsight_2$number_lessons), method="spearman")                                                                    
pcor.test(confinsight_2$Pos2, confinsight_2$ins_lessons,list( confinsight_2$math_edu, confinsight_2$number_lessons), method="spearman")                                                                    
pcor.test(confinsight2_2$Pos3, confinsight2_2$ins_lessons,list( confinsight2_2$math_edu, confinsight2_2$number_lessons), method="spearman")                                                                
cori <- cbind(                                                                                                                                                                                             
pcor.test(confinsight_2$Pos1, confinsight_2$Pos2,list( confinsight_2$math_edu, confinsight_2$number_lessons), method="spearman")[,2],                                                                      
pcor.test(confinsight2_2$Pos1, confinsight2_2$Pos3,list( confinsight2_2$math_edu, confinsight2_2$number_lessons), method="spearman")[,2],                                                                  
pcor.test(confinsight2_2$Pos2, confinsight2_2$Pos3,list( confinsight2_2$math_edu, confinsight2_2$number_lessons), method="spearman")[,2],                                                                  
pcor.test(confinsight_2$Pos1, confinsight_2$ins_lessons,list( confinsight_2$math_edu, confinsight_2$number_lessons), method="spearman")[,2],                                                               
pcor.test(confinsight_2$Pos2, confinsight$ins_lessons,list( confinsight_2$math_edu, confinsight_2$number_lessons), method="spearman")[,2],                                                                 
pcor.test(confinsight2_2$Pos3, confinsight2_2$ins_lessons,list( confinsight2_2$math_edu, confinsight2_2$number_lessons), method="spearman")[,2])                                                           
format(p.adjust(cori, method="holm"), scientific=F)                                                                                                                                                        
perf_confs_2 <- mixed(acc~test_condition*ins_lessons + confidence*test_condition+(1|participant), data=confmeaninsight_2,family=binomial,check_contrasts=F,method="LRT")                                   
perf_confs_2                                                                                                                                                                                               
contrast(emmeans(perf_confs_2,~ins_lessons|test_condition,cov.reduce=F), "revpairwise",simple=list("ins_lessons"), combine=T, adjust="holm")                                                               
conf_trends_2 <- emtrends(perf_confs_2,var="confidence",specs=c("test_condition"))                                                                                                                         
summary(conf_trends_2,infer=TRUE,null=0, adjust="holm")                                                                                                                                                    
                                                                                                                                                                                                           
perf_confs_cov_2 <- mixed(acc~test_condition*number_lessons+test_condition*ins_lessons+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight_2,family=binomial,        
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov_2                                                                                                                                                                                           
conf_trends_cov_2 <- emtrends(perf_confs_cov_2,var="confidence",specs=c("test_condition"))                                                                                                                 
summary(conf_trends_cov_2,infer=T,null=0, adjust="holm")                                                                                                                                                   
perf_confs_cov <- mixed(acc~test_condition*number_lessons+test_condition*insight+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight,family=binomial,                
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov                                                                                                                                                                                             
                                                                                                                                                                                                           
perf_confs <- mixed(acc~test_condition*insight + confidence*test_condition+(1|participant), data=confmeaninsight,family=binomial,check_contrasts=F,method="LRT")                                           
perf_confs                                                                                                                                                                                                 
                                                                                                                                                                                                           
contrast(emmeans(perf_confs,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                                         
contrast(emmeans(perf_ins_2,~ins_lessons|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("ins_lessons"),adjust="holm")                                                                 
perf_ins_cov <- mixed(acc~test_condition*number_lessons+test_condition*insight+math_edu*test_condition +(1|participant), data=insight_perf,family=binomial,check_contrasts=F,method="LRT")                 
perf_ins_cov                                                                                                                                                                                               
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_ins_cov,~insight|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight"), adjust="holm")                                                                      
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number_lessons!=0)                                                                                                                                                    
tests$test_condition <- relevel(as.factor(tests$test_condition), ref="Test1_non_circles")                                                                                                                  
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
                                                                                                                                                                                                           
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1)                                                                                                                                                        
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
                                                                                                                                                                                                           
perf_confs_cov <- mixed(acc~test_condition*number_lessons+test_condition*insight+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight,family=binomial,                
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov                                                                                                                                                                                             
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                                     
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm", rg.limit = 10080)                                                                     
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm", emm_options(rg.limit = <new limit>))                                                                     
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm", emm_options(rg.limit = 10080))                                                                     
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F), "revpairwise",simple=list("insight"), combine=T, adjust="holm", rg.limit = 20080)                                                                     
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F, rg.limit=20080), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                                     
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                                     
perf_confs_cov
contrast(emmeans(perf_confs_cov,~insight|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                     
perf_confs_cov_p <- mixed(acc~test_condition*number_lessons+test_condition*insight+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight_p,family=binomial,            
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov_p                                                                                                                                                                                           
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf_p <- merge(tests,insights_post)                                                                                                                                                               
confmeaninsight_p <- merge(conf_perf, insights_post)                                                                                                                                                       
                                                                                                                                                                                                           
perf_confs_cov_p <- mixed(acc~test_condition*number_lessons+test_condition*insight+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight_p,family=binomial,            
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov_p                                                                                                                                                                                           
contrast(emmeans(perf_confs_cov_p,~insight|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight"), combine=T, adjust="holm")                                                   
                                                                                                                                                                                                           
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf_2 <- merge(tests,insight_teach)                                                                                                                                                               
confmeaninsight_2 <- merge(conf_perf, insight_teach)                                                                                                                                                       
                                                                                                                                                                                                            
perf_ins_cov_2 <- mixed(acc~test_condition*number_lessons+test_condition*ins_lessons+math_edu*test_condition +(1|participant), data=insight_perf_2,family=binomial,check_contrasts=F,method="LRT")         
perf_confs_cov_2 <- mixed(acc~test_condition*number_lessons+test_condition*ins_lessons+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight_2,family=binomial,        
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov_2                                                                                                                                                                                           
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_cov_2,~ins_lessons|test_condition,cov.reduce=F), "revpairwise",simple=list("ins_lessons"), combine=T, adjust="holm")                                                           
head(insight_moments)
head(insights)
head(insight)
table(insight$position, insight$response)
subset(insight, included==1 & number_lessons!=0)
insight=subset(insight, included==1 & number_lessons!=0)
table(insight$position, insight$response)
insight_p <- glm(insight~number_lessons+math_edu, data=insights_post,family=binomial)                                                                                                                      
Anova(insight_p, type="III")                                                                                                                                                                               
quit()
summary(insight_perf)
table(insight_perf)
table(insight_perf$participant)
table(insight_perf$participant, insight_perf$test_condition)
table(insight_perf_test_condition, insight_perf$participant)
table(insight_perf$test_condition, insight_perf$participant)
summary(insight_moments)
summary(insight)
summary(tests)
insight_prev=merge(tests, insight)
summary(insight_prev)
table(insight$position)
table(insight$position, insight$response))
table(insight$position, insight$response)
tests$insight_prev <- ifelse(insight$position==lessons & insight$response==1, 1, 0)
tests$insight_prev <- ifelse(insight$position=="lessons" & insight$response==1, 1, 0)
head(insight_prev)
insight_prev$prev_ins=0
head(insight_prev)
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1"))
insight_prev=ifelse(position=="lessons" & response==1, 1, 0)
insight_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)
table(insight_prev$prev_ins)
table(insight_prev$prev_ins)
summary(insigth_prev)
summary(insight_prev)
insight_prev=merge(tests, insight)
summary(insight_prev)
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1"))
insight_prev$ins_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)
summary(insight_prev)
table(insight_prev)
table(insight_prev$ins_prev)
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) & insight_prev$test_condition%in%c("Test1", 1, 0)
))
grepl("dad", "dad", )
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) & grepl(insight_prev$test_condition, "Test1"==1), 1, 0)
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) & grepl(insight_prev$test_condition, "Test1")==1), 1, 0)
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) & grepl(insight_prev$test_condition, "Test1")==1, 1, 0)
grepl(insight_prev$test_condition, "Test1")
grepl(insight_prev$test_condition, "Test1", fixed=T)
grepl(insight_prev$test_condition, "Test2", fixed=T)
str_detect(insight_prev$test_condition, "Test1")
librayr(stringr)
library(stringr)
str_detect(insight_prev$test_condition, "Test1")
str_detect(insight_prev$test_condition, "Test1")insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) &  str_detect(insight_prev$test_condition, "Test1")=T, 1, 0)                                                    
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) &  str_detect(insight_prev$test_condition, "Test1")=T, 1, 0)                                                    
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) &  str_detect(insight_prev$test_condition, "Test1")==T, 1, 0)                                                    
head(insight_prev)
summary(tests)
head(tests)
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) &  test="Test1", 1, 0)                                                                                          
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) &  test=="Test1", 1, 0)                                                    
insight_prev$ins_prev=ifelse((insight_prev$position=="lessons" & insight_prev$response==1) &  insight_prev$test=="Test1", 1, 0)                                                    
insight_prev=0                                                                                                                                                                                             
insight_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)                                                                                                                     
insight_prev=merge(tests, insight)                                                                                                                                                                         
### enlever insight des prétests                                                                                                                                                                           
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1"))                                                                                                         
                                                                                                                                                                                                           
insight_prev$ins_prev=0                                                                                                                                                                                    
insight_prev$ins_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)                                                                                                            
table(insight_prev$position)
summary(tests)
table(insight$position, insight$response)
insight_prev=merge(tests, insight, by="participant")                                                                                                                                                       
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1", "confidence_rating1", "confidence_rating2", "lesson1", "lesson2", "lesson3", "lesson4", "lesson5",       
"lesson6", lesson7"))                                                                                                                                                                                      
)
""
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1", "confidence_rating1", "confidence_rating2", "lesson1", "lesson2", "lesson3", "lesson4", "lesson5",       
 "lesson6", lesson7"))                                                                                                                                                                                     
"
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1", "confidence_rating1", "confidence_rating2", "lesson1", "lesson2", "lesson3", "lesson4",                  
 "lesson5","lesson6", "lesson7"))                                                                                                                                                                          
                                                                                                                                                                                                           
insight_prev$ins_prev=0                                                                                                                                                                                    
insight_prev$ins_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)                                                                                                            
insight_prev$ins_prev[insight_prev$test=="Test2" & insight_prev$position%in%c("straight_lines_on_spheres2", "definition2 ") & insight_prev$response==1] <- 1                                               
insight_prev$ins_prev[insight_prev$test=="Test3" & insight_prev$position=="straight_lines_on_various_surfaces" & insight_prev$response==1] <- 1                                                            
insight_prev
nrow(insight_prev)
nrow(tests)
18144/3024
levels(as.factor(insight_prev$position))
insight_prev=subset(insight_prev, select=-c("position", response"))
"
insight_prev=subset(insight_prev, select=-c("position", "response"))
insight_prev=subset(insight_prev, select=-c(position, response))
head(insight_prev)
insight_prev=merge(tests, insight)                                                                                                                                                                         
### enlever insight des prétests                                                                                                                                                                           
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1", "confidence_rating1", "confidence_rating2", "lesson1", "lesson2", "lesson3", "lesson4",                  
 "lesson5","lesson6", "lesson7"))                                                                                                                                                                          
                                                                                                                                                                                                           
insight_prev$ins_prev=0                                                                                                                                                                                    
insight_prev$ins_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)                                                                                                            
                                                                                                                                                                                                           
insight_prev$ins_prev[insight_prev$test=="Test2" & insight_prev$position%in%c("straight_lines_on_spheres2", "definition2 ") & insight_prev$response==1] <- 1                                               
                                                                                                                                                                                                           
insight_prev$ins_prev[insight_prev$test=="Test3" & insight_prev$position=="straight_lines_on_various_surfaces" & insight_prev$response==1] <- 1                                                            
insight_prev=subset(insight_prev, select=-c(position, response))
head(insight_prev)
nrow(insight_prev)
insight_prev=merge(tests, insight)                                                                                                                                                                         
### enlever insight des prétests                                                                                                                                                                           
insight_prev=subset(insight_prev, !position%in%c("planar_geometry", "straight_lines_on_spheres1", "confidence_rating1", "confidence_rating2", "lesson1", "lesson2", "lesson3", "lesson4",                  
 "lesson5","lesson6", "lesson7"))                                                                                                                                                                          
                                                                                                                                                                                                           
insight_prev$ins_prev=0                                                                                                                                                                                    
insight_prev$ins_prev=ifelse(insight_prev$position=="lessons" & insight_prev$response==1, 1, 0)                                                                                                            
                                                                                                                                                                                                           
insight_prev$ins_prev[insight_prev$test=="Test2" & insight_prev$position%in%c("straight_lines_on_spheres2", "definition2 ") & insight_prev$response==1] <- 1                                               
                                                                                                                                                                                                           
insight_prev$ins_prev[insight_prev$test=="Test3" & insight_prev$position=="straight_lines_on_various_surfaces" & insight_prev$response==1] <- 1                                                            
insight_prev=aggregate(acc~participant+number_lessons+math_edu+included+test_condition+test+lessons+ins_prev, data=insight_prev, FUN=mean)
nrow(insight_prev)
nrow(tests)
testy=tests 
testy$ins_prev=0
testy$ins_prev[testy$test=Test1]=ifelse(insight$position=="lesson" & insight$response==1, 1, 0)
testy$ins_prev[testy$test=="Test1"]=ifelse(insight$position=="lesson" & insight$response==1, 1, 0)
insight_lessons=subset(insight, select="participant",insight$position=="lessons" & insight$response==1)                                                                                                    
 insight_lessons
nrow(insight_lessons)
insight_test2=subset(insight, select="participant", insight$position%in%c("straight_lines_on_spheres2", "definition2 " & insight$response==1)                                                              
)
insight_test2=subset(insight, select="participant", insight$position%in%c("straight_lines_on_spheres2", "definition2 ") & insight$response==1)                                                             
insight_test2
insight_test3=subset(insight, select="participant", insight$position=="straight_lines_on_various_surfaces" & insight$response==1)                                                                          
insight_test3
prev_ins=tests                                                                                                                                                                                             
prev_ins$insight_bef=0                                                                                                                                                                                     
prev_ins$insight_bef[prev_ins$test=="Test1" & participant%in%insight_lessons$participant] <- 1                                                                                                             
prev_ins$insight_bef[prev_ins$test=="Test1" & prev_ins$participant%in%insight_lessons$participant] <- 1                                                                                                    
insight_lessons=subset(insight, select="participant",insight$position=="lessons" & insight$response==1)                                                                                                    
                                                                                                                                                                                                           
#### avant test2                                                                                                                                                                                           
insight_test2=subset(insight, select="participant", insight$position%in%c("straight_lines_on_spheres2", "definition2 ") & insight$response==1)                                                             
                                                                                                                                                                                                           
                                                                                                                                                                                                           
### avant test3                                                                                                                                                                                            
insight_test3=subset(insight, select="participant", insight$position=="straight_lines_on_various_surfaces" & insight$response==1)                                                                          
                                                                                                                                                                                                           
#####                                                                                                                                                                                                      
prev_ins=tests                                                                                                                                                                                             
prev_ins$insight_bef=0                                                                                                                                                                                     
prev_ins$insight_bef[prev_ins$participant%in%insight_lessons$participant] <- 1                                                                                                                             
prev_ins$insight_bef[prev_ins$test=="Test2" & prev_ins$participant%in%insight_test2$participant] <- 1                                                                                                      
prev_ins$insight_bef[prev_ins$test=="Test3" & prev_ins$participant%in%insight_test3$participant] <- 1                                                                                                      
                                                                                                                                                                                                           
prev_ins
subset(prev_ins, insight_bef==1)
subset(prev_ins, select=c(participant, test, insight_bef), insight_bef==1)
subset(prev_ins, select=c(participant, test, insight_bef))
insight_lessons
insight_test3
insight_test2
subset(insight_prev, participant=="part10_35")
subset(prev_ins, participant=="part10_35")
subset(insight_test3, !participant%in%insight_lessons)
subset(insight_test3, !participant%in%insight_test2)
subset(prev_ins, participant=="part18_35")
insight_test2
insight_lessons
insight_test3
subset(prev_ins, participant=="part28_35")
subset(prev_ins, participant=="part28")
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
summary(prev_ins)
summary(insight_perf)
perf_ins_bef <- mixed(acc~insight_bef*test_condition+ (1|participant), data=prev_ins,family=binomial,check_contrasts=FALSE,method="LRT")                                                                   
perf_ins_bef                                                                                                                                                                                               
 library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                          
                                                                                                                                                                                                           
perf_ins_bef <- mixed(acc~insight_bef*test_condition+ (1|participant), data=prev_ins,family=binomial,check_contrasts=FALSE,method="LRT")                                                                   
perf_ins_bef                                                                                                                                                                                               
                                                                                                                                                                                                           
contrast(emmeans(perf_ins_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"),adjust="holm")                                                               
confint(contrast(emmeans(perf_ins_bef,~insight|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"),adjust="holm"))                                                          
perf_ins_cov_bef <- mixed(acc~test_condition*number_lessons+test_condition*insight_bef+math_edu*test_condition +(1|participant), data=prev_ins,family=binomial,check_contrasts=F,method="LRT")             
perf_ins_cov_bef                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm")                                                          
confint(contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm"))                                                 
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
confmeaninsight <- merge(conf_perf, prev_ins)                                                                                                                                                              
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
confmeaninsight_bef <- merge(conf_perf, prev_ins)                                                                                                                                                          
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                          
summary(confmeaninsight_bef)
summary(confmeaninsight)
confmeaninsight_bef <- merge(conf_perf, subset(prev_ins, select=c(insight_bef, test, test_condition, participant))                                                                                                                                                          
)
summary(confmeaninsight_bef)
conf_perf <- merge(tests, conf_mean)   
summary(conf_perf)
summary(prev_ins)
head(merge(prev_ins, conf_perf)
)
head(prev_ins))
head(prev_ins)
head(conf_perf)
head(merge(prev_ins, conf_perf, by=c(participant, number_lessons, math_edu, included, acc, test_condition, test))
)
head(merge(prev_ins, conf_perf, by=c("participant", "number_lessons", "math_edu", "included", "acc", "test_condition", "test")))
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
summary(conf_perf)
confmeaninsight_bef <- conf_perf                                                                                                                                                                           
confmeaninsight_bef$insight_bef <- 0                                                                                                                                                                       
confmeaninsight_bef$insight_bef[confmeaninsight_bef$participant%in%insight_lessons$participant] <- 1                                                                                                       
confmeaninsight_bef$insight_bef[confmeaninsight_bef$test=="Test2" & confmeaninsight_bef$participant%in%insight_test2$participant] <- 1                                                                     
confmeaninsight_bef$insight_bef[confmeaninsight_bef$test=="Test3" & confmeaninsight_bef$participant%in%insight_test3$participant] <- 1                                                                     
summary(confmeaninsight_bef)
subset(confmeaninsight_bef, participant=="18_35")
subset(confmeaninsight_bef, participant=="part18_35")
subset(confmeaninsight_bef, participant=="part28")
perf_confs_bef <- mixed(acc~test_condition*insight_bef + confidence*test_condition+(1|participant), data=confmeaninsight_bef,family=binomial,check_contrasts=F,method="LRT")                               
perf_confs_bef                                                                                                                                                                                             
contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                                             
perf_confs_cov_bef <- mixed(acc~test_condition*number_lessons+test_condition*insight_bef+math_edu*test_condition + confidence*test_condition+(1|participant), data=confmeaninsight_bef,family=binomial,    
check_contrasts=F,method="LRT")                                                                                                                                                                            
perf_confs_cov_bef                                                                                                                                                                                         
 contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                         
quit()
