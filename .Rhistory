tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1)                                                                                                                                                                        
##### optionnal                                                                                                                                                                                            
## tests$test_condition <- relevel(as.factor(tests$test_condition), ref="Test1_non_circles")                                                                                                               
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 )                                                                                                                                                             
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1)                                                                                                                                                                    
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1)                                                                                                                                                            
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1)                                                                                                                                                        
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 )                                                                                                                                                             
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
insight_perf$insight <- as.factor(insight_perf$insight)                                                                                                                                                    
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
confmeaninsight$insight <- as.factor(confmeaninsight$insight)                                                                                                                                              
summary(confmeaninsight)
4536/84
                                                                                                                                                                                                           
perf_confs_0 <- mixed(acc~test_condition*insight + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,check_contrasts=T,method="LRT")                                       
perf_confs_0                                                                                                                                                                                               
summary(perf_confs_0)
lessons_perf_0 <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                       
lessons_perf_0                                                                                                                                                                                             
                                                                                                                                                                                                           
#### centering numerical variables                                                                                                                                                                         
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
lessons_perf_0 <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                       
lessons_perf_0                                                                                                                                                                                             
summary(lessons_perf_0)
nsight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
insight_lessons_0 <- glm(insight~number_lessons_n+math_edu_n, data=insight_bin,family=binomial)                                                                                                            
Anova(insight_lessons_0, type="III")                                                                                                                                                                       
                                                                                                                                                                                                           
 ###############################################  Effect of number of lessons on Insight reports ###################################################################                                        
insight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
insight_lessons_0 <- glm(insight~number_lessons_n+math_edu_n, data=insight_bin,family=binomial)                                                                                                            
Anova(insight_lessons_0, type="III")                                                                                                                                                                       
summary(insight_lessons_0)
                                                                                                                                                                                                          
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
insight_perf$insight <- as.factor(insight_perf$insight)                                                                                                                                                    
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
confmeaninsight$insight <- as.factor(confmeaninsight$insight)                                                                                                                                              
perf_ins_0 <- mixed(acc~insight*test_condition+ (1|participant), data=insight_perf,family=binomial,check_contrasts=TRUE,method="LRT")                                                                      
perf_ins_0                                                                                                                                                                                                 
                                                                                                                                                                                                           
summary(perf_ins_0)
perf_confs_cov_0 <- mixed(acc~test_condition*number_lessons_n+test_condition*insight+math_edu_n*test_condition + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,        
check_contrasts=T,method="LRT")                                                                                                                                                                            
summary(perf_confs_cov_0)                                                                                                                                                                                  
perf_ins_cov_0 <- mixed(acc~test_condition*number_lessons_n+test_condition*insight+math_edu_n*test_condition +(1|participant), data=insight_perf,family=binomial,check_contrasts=T,method="LRT")           
summary(perf_ins_cov_0)                                                                                                                                                                                    
perf_ins_cov_0
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1)                                                                                                                                                                        
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1)                                                                                                                                                                        
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 )                                                                                                                                                             
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1)                                                                                                                                                                    
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1)                                                                                                                                                            
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1)                                                                                                                                                        
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 )                                                                                                                                                             
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
                                                                                                                                                                                                           
                                                                                                                                                                                                           
############################################## Effect of number of lessons on performance ########################################################################                                         
                                                                                                                                                                                                           
#### centering numerical variables                                                                                                                                                                         
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
insight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
insight_perf$insight <- as.factor(insight_perf$insight)                                                                                                                                                    
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
confmeaninsight$insight <- as.factor(confmeaninsight$insight)                                                                                                                                              
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number!=0)                                                                                                                                                            
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                                
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1 & number_lessons!=0)                                                                                                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
                                                                                                                                                                                                           
summary(                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                                
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1 & number_lessons!=0)                                                                                                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
                                                                                                                                                                                                           
                                                                                                                                                                                                           
summary(insight)
summary(insight_bin)
896/54
56/14
summary(insight_pre)
insight_pre=subset(insight, select="participant", insight$position%in%c("planar_geometry", "straight_lines_on_spheres1") & insight$response==1)                                                            
insight_pre=unique(insight_pre)                                                                                                                                                                            
                                                                                                                                                                                                           
### parts with insight before lessons                                                                                                                                                                      
insight_lessons=subset(insight, select="participant",insight$position=="lessons" & insight$response==1)                                                                                                    
                                                                                                                                                                                                           
#### before test 2                                                                                                                                                                                         
insight_test2=subset(insight, select="participant", insight$position%in%c("straight_lines_on_spheres2", "definition2") & insight$response==1)                                                              
insight_test2 <- unique(insight_test2)                                                                                                                                                                     
                                                                                                                                                                                                           
### before test 3                                                                                                                                                                                          
insight_test3=subset(insight, select="participant", insight$position=="straight_lines_on_various_surfaces" & insight$response==1)                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
###### insights inédits avant lessons, test2 puis test3                                                                                                                                                    
insight_lessons$participant[!insight_lessons$participant%in%insight_pre$participant]                                                                                                                       
insight_test2$participant[!insight_test2$participant%in%insight_lessons$participant]                                                                                                                       
insight_test3$participant[!insight_test3$participant%in%insight_test2$participant]                                                                                                                         
                                                                                                                                                                                                           
#####                                                                                                                                                                                                      
prev_ins=tests                                                                                                                                                                                             
prev_ins$insight_bef=0                                                                                                                                                                                     
prev_ins$insight_bef[prev_ins$participant%in%insight_pre$participant] <- 1                                                                                                                                 
prev_ins$insight_bef[prev_ins$participant%in%insight_lessons$participant] <- 1                                                                                                                             
prev_ins$insight_bef[(prev_ins$test=="Test2" | prev_ins$test=="Test3") & prev_ins$participant%in%insight_test2$participant] <- 1                                                                           
## prev_ins$insight_bef[prev_ins$test=="Test3" & prev_ins$participant%in%insight_test2$participant] <- 1                                                                                                   
prev_ins$insight_bef[prev_ins$test=="Test3" & prev_ins$participant%in%insight_test3$participant] <- 1                                                                                                      
                                                                                                                                                                                                           
                                                                                                                                                                                                           
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
confmeaninsight_bef <- conf_perf                                                                                                                                                                           
confmeaninsight_bef$insight_bef <- 0                                                                                                                                                                       
confmeaninsight_bef$insight_bef[confmeaninsight_bef$participant%in%insight_pre$participant] <- 1                                                                                                           
confmeaninsight_bef$insight_bef[confmeaninsight_bef$participant%in%insight_lessons$participant] <- 1                                                                                                       
confmeaninsight_bef$insight_bef[(confmeaninsight_bef$test=="Test2" | confmeaninsight_bef$test=="Test3") & confmeaninsight_bef$participant%in%insight_test2$participant] <- 1                               
confmeaninsight_bef$insight_bef[confmeaninsight_bef$test=="Test3" & confmeaninsight_bef$participant%in%insight_test3$participant] <- 1                                                                     
                                                                                                                                                                                                           
                                                                                                                                                                                                           
insight_lessons_bef <- glm(insight_bef~number_lessons_n+math_edu_n, data=prev_ins,family=binomial)                                                                                                         
Anova(insight_lessons_bef, type="III")                                                                                                                                                                     
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
summary(prev_ins)
summary(conf_mean)
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
summary(tests)
summary(prev_ins)
prev_ins$number_lessons_n <- scale(prev_ins$number_lessons, center=TRUE, scale=FALSE)                                                                                                                      
prev_ins$math_edu_n <- scale(prev_ins$math_edu, center=TRUE, scale=FALSE)                                                                                                                                  
                                                                                                                                                                                                           
summary(prev_ins)
summary(conf_mean)
                                                                                                                                                                                                           
insight_lessons_bef <- glm(insight_bef~number_lessons_n+math_edu_n, data=prev_ins,family=binomial)                                                                                                         
Anova(insight_lessons_bef, type="III")                                                                                                                                                                     
Anova(insight_lessons, type="III")                                                                                                                                                                     
insight_lessons
perf_ins_cov_bef <- mixed(acc~test_condition*number_lessons_n+test_condition*insight_bef+math_edu_n*test_condition +(1|participant), data=prev_ins,family=binomial,check_contrasts=F,method="LRT")         
perf_ins_cov_bef                                                                                                                                                                                           
                                                                                                                                                                                                          
contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm")                                                          
confint(contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm"))                                                 
                                                                                                                                                                                                          
confcol<-dcast(participant+included+number_lessons_n+math_edu_n~measurement,value.var="confidence_n",data=confidence)                                                                                      
 summary(confidence)
confidence$confidence_n <- scale(confidence$confidence, center=TRUE, scale=FALSE)  
 summary(confidence)
#### data frames merging data about insight, confidence and performance                                                                                                                                    
confidence$number_lessons_n <- scale(confidence$number_lessons, center=TRUE, scale=FALSE)                                                                                                                  
confidence$math_edu_n <- scale(confidence$math_edu, center=TRUE, scale=FALSE)                                                                                                                              
confidence$confidence_n <- scale(confidence$confidence, center=TRUE, scale=FALSE)                                                                                                                          
summary(confidence)
confcol<-dcast(participant+included+number_lessons_n+math_edu_n~measurement,value.var="confidence_n",data=confidence)                                                                                      
                                                                                                                                                                                                           
### one separate df for pos3 confidence comparisons, as one data is missing for pos3.                                                                                                                      
confinsight_bef <- merge(confcol,prev_ins)                                                                                                                                                                 
confinsight2_bef=subset(confinsight, Pos3!="NA")                                                                                                                                                           
                                                                                                                                                                                                           
## not the same nb of df : one missing data point for conf 3                                                                                                                                              
cor.test(~Pos1+Pos2,data=confinsight, method="spearman")                                                                                                                                                   
cor.test(~Pos1+Pos3,data=confinsight2, method="spearman")                                                                                                                                                  
cor.test(~Pos2+Pos3,data=confinsight2, method="spearman")                                                                                                                                                  
cor.test(~Pos1+insight,data=confinsight, method="spearman")                                                                                                                                                
cor.test(~Pos2+insight,data=confinsight, method="spearman")                                                                                                                                                
cor.test(~Pos3+insight,data=confinsight2, method="spearman")                                                                                                                                               
                                                                                                                                                                                                           
### p values corrected with holm                                                                                                                                                                           
cory <- cbind(                                                                                                                                                                                             
cor.test(~Pos1+Pos2,data=confinsight, method="spearman"),                                                                                                                                                  
cor.test(~Pos1+Pos3,data=confinsight2, method="spearman"),                                                                                                                                                 
cor.test(~Pos2+Pos3,data=confinsight2, method="spearman"),                                                                                                                                                 
cor.test(~Pos1+insight,data=confinsight, method="spearman"),                                                                                                                                               
cor.test(~Pos2+insight,data=confinsight, method="spearman"),                                                                                                                                               
cor.test(~Pos3+insight,data=confinsight2, method="spearman"))                                                                                                                                              
format(p.adjust(cory[3,], method="holm"),scientific=F)                                                                                                                                                     
## Correlations with math_edu and number of lessons as covariates                                                                                                                                         
pcor.test(confinsight$Pos1, confinsight$Pos2,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")                                                                                   
pcor.test(confinsight2$Pos1, confinsight2$Pos3,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")                                                                               
pcor.test(confinsight2$Pos2, confinsight2$Pos3,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")                                                                               
pcor.test(confinsight$Pos1, confinsight$insight,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")                                                                                
pcor.test(confinsight$Pos2, confinsight$insight,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")                                                                                
pcor.test(confinsight2$Pos3, confinsight2$insight,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")                                                                            
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### p values corrected with holm                                                                                                                                                                          
cori <- cbind(                                                                                                                                                                                             
pcor.test(confinsight$Pos1, confinsight$Pos2,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")[,2],                                                                              
pcor.test(confinsight2$Pos1, confinsight2$Pos3,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")[,2],                                                                          
pcor.test(confinsight2$Pos2, confinsight2$Pos3,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")[,2],                                                                          
pcor.test(confinsight$Pos1, confinsight$insight,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")[,2],                                                                           
pcor.test(confinsight$Pos2, confinsight$insight,list( confinsight$math_edu, confinsight$number_lessons), method="spearman")[,2],                                                                           
pcor.test(confinsight2$Pos3, confinsight2$insight,list( confinsight2$math_edu, confinsight2$number_lessons), method="spearman")[,2])                                                                       
format(p.adjust(cori, method="holm"), scientific=F)                                                                                                                                                        
                                                                                                                                                                                                           
perf_confs_bef <- mixed(acc~test_condition*insight_bef + confidence_n*test_condition+(1|participant), data=confmeaninsight_bef,family=binomial,check_contrasts=F,method="LRT")                             
perf_confs_bef                                                                                                                                                                                             
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)            
summary(confmeaninsight_bef)
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
confmeaninsight_bef <- conf_perf                                                                                                                                                                           
confmeaninsight_bef$insight_bef <- 0                                                                                                                                                                       
confmeaninsight_bef$insight_bef[confmeaninsight_bef$participant%in%insight_pre$participant] <- 1                                                                                                           
confmeaninsight_bef$insight_bef[confmeaninsight_bef$participant%in%insight_lessons$participant] <- 1                                                                                                       
confmeaninsight_bef$insight_bef[(confmeaninsight_bef$test=="Test2" | confmeaninsight_bef$test=="Test3") & confmeaninsight_bef$participant%in%insight_test2$participant] <- 1                               
confmeaninsight_bef$insight_bef[confmeaninsight_bef$test=="Test3" & confmeaninsight_bef$participant%in%insight_test3$participant] <- 1                                                                     
                                                                                                                                                                                                           
summary(confmeaninsight_bef)
                                                                                                                                                                                                           
perf_confs_bef <- mixed(acc~test_condition*insight_bef + confidence_n*test_condition+(1|participant), data=confmeaninsight_bef,family=binomial,check_contrasts=F,method="LRT")                             
perf_confs_bef                                                                                                                                                                                             
                                                                                                                                                                                                           
### Effect of insight (estimated contrast between participants who did vs. did not report an insight) on  accuracy by test condition                                                                       
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                                             
confint(contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
conf_trends <- emtrends(perf_confs_bef,var="confidence_n",specs=c("test_condition"))                                                                                                                       
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm")                                                                                                                                                  
                                                                                                                                                                                                           
                                                                                                                                                                                                          
conf_trends <- emtrends(perf_confs_bef,var="confidence_n",specs=c("test_condition"))                                                                                                                       
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm")                                                                                                                                                  
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm")                                                                                                                                                  conf_trends_bef <- emtrends(perf_confs_bef,var="confidence_n",specs=c("test_condition"))                                                                                                                   
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm")                                                                                                                                                  
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm") 
summary(conf_trends_bef)
                                                                                                                                                                                                          
conf_trends_bef <- emtrends(perf_confs_bef,var="confidence_n",specs=c("test_condition"))                                                                                                                   
summary(conf_trends_bef,infer=TRUE,null=0, adjust="holm")
                                                                                                                                                                                                          
perf_confs_cov_bef <- mixed(acc~test_condition*number_lessons_n+test_condition*insight_bef+math_edu_n*test_condition + confidence_n*test_condition+(1|participant),                                        
data=confmeaninsight_bef,family=binomial, check_contrasts=F,method="LRT")                                                                                                                                  
perf_confs_cov_bef                                                                                                                                                                                         
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                         
confint(contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                                
contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                         
confint(contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
confint(contrast(emmeans(perf_ins_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"),adjust="holm"))                                                      
confint(contrast(emmeans(perf_ins_cov_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise", combine=T, simple=list("insight_bef"), adjust="holm"))                                                 
                                                                                                                                                                                                           
confint(contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                                    
                                                                                                                                                                                                           
contrast(emmeans(perf_confs_bef,~insight_bef|test_condition,cov.reduce=F), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                                             
contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm")                                         
confint(contrast(emmeans(perf_confs_cov_bef,~insight_bef|test_condition,cov.reduce=F, rg.limit=10080), "revpairwise",simple=list("insight_bef"), combine=T, adjust="holm"))                                
summary(perf_confs_cov)
perf_confs_cov
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                                
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight pendant la teaching phase                                                                                                                                                                   
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1 & number_lessons!=0)                                                                                                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights pendant la deuxième partie de l'expé (tout sauf pré tests)                                                                                                                                   
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
                                                                                                                                                                                                           
                                                                                                                                                                                                           
############################################## Effect of number of lessons on performance ########################################################################                                         
                                                                                                                                                                                                           
#### centering numerical variables                                                                                                                                                                         
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
lessons_perf <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=TRUE,method="LRT")                                         
insight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
#### data frames merging data about insight, confidence and performance                                                                                                                                    
confidence$number_lessons_n <- scale(confidence$number_lessons, center=TRUE, scale=FALSE)                                                                                                                  
confidence$math_edu_n <- scale(confidence$math_edu, center=TRUE, scale=FALSE)                                                                                                                              
confidence$confidence_n <- scale(confidence$confidence, center=TRUE, scale=FALSE)                                                                                                                          
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
insight_perf$insight <- as.factor(insight_perf$insight)                                                                                                                                                    
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
confmeaninsight$insight <- as.factor(confmeaninsight$insight)                                                                                                                                              
confcol<-dcast(participant+included+number_lessons_n+math_edu_n~measurement,value.var="confidence",data=confidence_n)                                                                                      
                                                                                                                                                                                                           
### one separate df for pos3 confidence comparisons, as one data is missing for pos3.                                                                                                                      
confinsight <- merge(confcol,insight_bin)                                                                                                                                                                  
confinsight2=subset(confinsight, Pos3!="NA")                                                                                                                                                               
### not the same nb of df : one missing data point for conf 3                                                                                                                                              
cor.test(~Pos1+Pos2,data=confinsight, method="spearman")                                                                                                                                                   
cor.test(~Pos1+Pos3,data=confinsight2, method="spearman")                                                                                                                                                  
cor.test(~Pos2+Pos3,data=confinsight2, method="spearman")                                                                                                                                                  
cor.test(~Pos1+insight,data=confinsight, method="spearman")                                                                                                                                                
cor.test(~Pos2+insight,data=confinsight, method="spearman")                                                                                                                                                
cor.test(~Pos3+insight,data=confinsight2, method="spearman")                                                                                                                                               
                                                                                                                                                                                                           
### p values corrected with holm                                                                                                                                                                           
cory <- cbind(                                                                                                                                                                                             
cor.test(~Pos1+Pos2,data=confinsight, method="spearman"),                                                                                                                                                  
cor.test(~Pos1+Pos3,data=confinsight2, method="spearman"),                                                                                                                                                 
cor.test(~Pos2+Pos3,data=confinsight2, method="spearman"),                                                                                                                                                 
cor.test(~Pos1+insight,data=confinsight, method="spearman"),                                                                                                                                               
cor.test(~Pos2+insight,data=confinsight, method="spearman"),                                                                                                                                               
cor.test(~Pos3+insight,data=confinsight2, method="spearman"))                                                                                                                                              
format(p.adjust(cory[3,], method="holm"),scientific=F)                                                                                                                                                     
cor.test(~Pos1+insight,data=confinsight, method="spearman")
summary(confinsight)
confinsight$insight <- as.numeric(confinsight$insight)
summary(confinsight)
confinsight <- merge(confcol,insight_bin)                                                                                                                                                                  
confinsight2=subset(confinsight, Pos3!="NA") 
confinsight$insight <- as.numeric(as.character(confinsight$insight))  
summary(confinsight)
confinsight2$insight <- as.numeric(as.character(confinsight2$insight))                                                                                                                                     
summary(confinsight2)
cor.test(~Pos1+Pos2,data=confinsight, method="spearman")                                                                                                                                                   
cor.test(~Pos1+Pos3,data=confinsight2, method="spearman")                                                                                                                                                  
cor.test(~Pos2+Pos3,data=confinsight2, method="spearman")                                                                                                                                                  
cor.test(~Pos1+insight,data=confinsight, method="spearman")                                                                                                                                                
cor.test(~Pos2+insight,data=confinsight, method="spearman")                                                                                                                                                
cor.test(~Pos3+insight,data=confinsight2, method="spearman")                                                                                                                                               
                                                                                                                                                                                                           
cory <- cbind(                                                                                                                                                                                             
cor.test(~Pos1+Pos2,data=confinsight, method="spearman"),                                                                                                                                                  
cor.test(~Pos1+Pos3,data=confinsight2, method="spearman"),                                                                                                                                                 
cor.test(~Pos2+Pos3,data=confinsight2, method="spearman"),                                                                                                                                                 
cor.test(~Pos1+insight,data=confinsight, method="spearman"),                                                                                                                                               
cor.test(~Pos2+insight,data=confinsight, method="spearman"),                                                                                                                                               
cor.test(~Pos3+insight,data=confinsight2, method="spearman"))                                                                                                                                              
format(p.adjust(cory[3,], method="holm"),scientific=F)                                                                                                                                                     
pcor.test(confinsight$Pos1, confinsight$Pos2,list( confinsight$math_edu_n, confinsight$number_lessons), method="spearman")                                                                                 
pcor.test(confinsight2$Pos1, confinsight2$Pos3,list( confinsight2$math_edu_n, confinsight2$number_lessons_n), method="spearman")                                                                           
pcor.test(confinsight2$Pos2, confinsight2$Pos3,list( confinsight2$math_edu_n, confinsight2$number_lessons_n), method="spearman")                                                                           
pcor.test(confinsight$Pos1, confinsight$insight,list( confinsight$math_edu_n, confinsight$number_lessons_n), method="spearman")                                                                            
pcor.test(confinsight$Pos2, confinsight$insight,list( confinsight$math_edu_n, confinsight$number_lessons_n), method="spearman")                                                                            
pcor.test(confinsight2$Pos3, confinsight2$insight,list( confinsight2$math_edu_n, confinsight2$number_lessons_n), method="spearman")                                                                        
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### p values corrected with holm                                                                                                                                                                          
cori <- cbind(                                                                                                                                                                                             
pcor.test(confinsight$Pos1, confinsight$Pos2,list( confinsight$math_edu_n, confinsight$number_lessons_n), method="spearman")[,2],                                                                          
pcor.test(confinsight2$Pos1, confinsight2$Pos3,list( confinsight2$math_edu_n, confinsight2$number_lessons_n), method="spearman")[,2],                                                                      
pcor.test(confinsight2$Pos2, confinsight2$Pos3,list( confinsight2$math_edu_n, confinsight2$number_lessons_n), method="spearman")[,2],                                                                      
pcor.test(confinsight$Pos1, confinsight$insight,list( confinsight$math_edu_n, confinsight$number_lessons_n), method="spearman")[,2],                                                                       
pcor.test(confinsight$Pos2, confinsight$insight,list( confinsight$math_edu_n, confinsight$number_lessons_n), method="spearman")[,2],                                                                       
pcor.test(confinsight2$Pos3, confinsight2$insight,list( confinsight2$math_edu_n, confinsight2$number_lessons_n), method="spearman")[,2])                                                                   
format(p.adjust(cori, method="holm"), scientific=F)                                                                                                                                                        
quit()
