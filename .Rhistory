  geom_point(data=ins_plot,aes(y=acclogitcor, x=insight),size=2, alpha=1/3, position=position_jitter(w=0.05,h=0))+                                                                                         
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL),size=0.4,width=.2)+                                                                                                                                     
  facet_wrap(~test_condition, ncol=1)+                                                                                                                                                                     
  theme_classic()+                                                                                                                                                                                         
  geom_point(size=3)                                                                                                                                                                                       
  ## scale_x_discrete(labels=c("0"="No insight", "1"="Insight"))                                                                                                                                           
insac <-themetiny(insac)                                                                                                                                                                                   
insac <- insac  + xlab("Insight report")+ylab("Accuracy")                                                                                                                                                  
dev.new(width=7*0.65,height=4*0.65)                                                                                                                                                                        
insac                                                                                                                                                                                                      
                                                                                                                                                                                                           
summary(ins_plot)
                                                                                                                                                                                                           
ins_plot=aggregate(acc~participant+insight+number_lessons_n+test_condition+math_edu_n+confidence_n, data=subset(confmeaninsight, test_condition=="Test2_straight_nonplanar"), FUN=mean)                    
ins_plot$acclogit=logit(ins_plot$acc, adjust=0.01)                                                                                                                                                         
                                                                                                                                                                                                           
### correction for maths edu + interaction                                                                                                                                                                 
ins_plot$acclogitcor=ins_plot$acclogit-((ins_plot$math_edu_n)*(summary(perf_confs_cov_plot)$coefficients[12,1]))                                                                                           
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$math_edu_n)*(summary(perf_confs_cov_plot)$coefficients[34,1]))                                                                                        
                                                                                                                                                                                                           
##### correction for number of lesson                                                                                                                                                                      
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$number_lessons_n)*(summary(perf_confs_cov_plot)$coefficients[10,1]))                                                                                  
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$number_lessons_n)*(summary(perf_confs_cov_plot)$coefficients[18,1]))                                                                                  
                                                                                                                                                                                                           
### correction for confidence                                                                                                                                                                              
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$confidence_n)*(summary(perf_confs_cov_plot)$coefficients[13,1]))                                                                                      
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$confidence_n)*(summary(perf_confs_cov_plot)$coefficients[42,2]))                                                                                      
                                                                                                                                                                                                           
ins_plot$acclogitcor=exp(ins_plot$acclogitcor)/(1+exp(ins_plot$acclogitcor))                                                                                                                               
                                                                                                                                                                                                           
ins <-summary( emmeans(perf_confs_cov_plot, specs=c("insight", "test_condition"), rg.limit=10080, cov.reduce=F), type="response")                                                                          
predict_ins <- data.frame(ins)                                                                                                                                                                             
predict_ins=subset(predict_ins, test_condition=="Test2_straight_nonplanar")                                                                                                                                
typeof(predict_ins$insight)
typeof(ins_plot$insight)
insac <- ggplot(aes(x=insight,y=prob),data=predict_ins)+                                                                                                                                                   
  geom_point(data=ins_plot,aes(y=acclogitcor, x=insight),size=2, alpha=1/3, position=position_jitter(w=0.05,h=0))+                                                                                         
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL),size=0.4,width=.2)+                                                                                                                                     
  facet_wrap(~test_condition, ncol=1)+                                                                                                                                                                     
  theme_classic()+                                                                                                                                                                                         
  geom_point(size=3)                                                                                                                                                                                       
  ## scale_x_discrete(labels=c("0"="No insight", "1"="Insight"))                                                                                                                                           
insac <-themetiny(insac)                                                                                                                                                                                   
insac <- insac  + xlab("Insight report")+ylab("Accuracy")                                                                                                                                                  
dev.new(width=7*0.65,height=4*0.65)                                                                                                                                                                        
insac                                                                                                                                                                                                      
ggsave("insight_Test2_straight_nonplanar.pdf")                                                                                                                                                             
                                                                                                                                                                                                          
                                                                                                                                                                                                           
ins_plot=aggregate(acc~participant+insight+number_lessons_n+test_condition+math_edu_n+confidence_n, data=subset(confmeaninsight, test_condition=="Test2_straight_nonplanar"), FUN=mean)                    
ins_plot$acclogit=logit(ins_plot$acc, adjust=0.01)                                                                                                                                                         
                                                                                                                                                                                                           
### correction for maths edu + interaction                                                                                                                                                                 
ins_plot$acclogitcor=ins_plot$acclogit-((ins_plot$math_edu_n)*(summary(perf_confs_cov_plot)$coefficients[12,1]))                                                                                           
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$math_edu_n)*(summary(perf_confs_cov_plot)$coefficients[34,1]))                                                                                        
                                                                                                                                                                                                           
##### correction for number of lesson                                                                                                                                                                      
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$number_lessons_n)*(summary(perf_confs_cov_plot)$coefficients[10,1]))                                                                                  
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$number_lessons_n)*(summary(perf_confs_cov_plot)$coefficients[18,1]))                                                                                  
                                                                                                                                                                                                           
### correction for confidence                                                                                                                                                                              
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$confidence_n)*(summary(perf_confs_cov_plot)$coefficients[13,1]))                                                                                      
ins_plot$acclogitcor=ins_plot$acclogitcor-((ins_plot$confidence_n)*(summary(perf_confs_cov_plot)$coefficients[42,2]))                                                                                      
                                                                                                                                                                                                           
ins_plot$acclogitcor=exp(ins_plot$acclogitcor)/(1+exp(ins_plot$acclogitcor))                                                                                                                               
                                                                                                                                                                                                           
ins <-summary( emmeans(perf_confs_cov_plot, specs=c("insight", "test_condition"), rg.limit=10080, cov.reduce=F), type="response")                                                                          
predict_ins <- data.frame(ins)                                                                                                                                                                             
predict_ins=subset(predict_ins, test_condition=="Test2_straight_nonplanar")                                                                                                                                
                                                                                                                                                                                                           
                                                                                                                                                                                                           
insac <- ggplot(aes(x=insight,y=prob),data=predict_ins)+                                                                                                                                                   
  geom_point(data=ins_plot,aes(y=acclogitcor, x=insight),size=2, alpha=1/3, position=position_jitter(w=0.05,h=0))+                                                                                         
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL),size=0.4,width=.2)+                                                                                                                                     
  facet_wrap(~test_condition, ncol=1)+                                                                                                                                                                     
  theme_classic()+                                                                                                                                                                                         
  geom_point(size=3)                                                                                                                                                                                       
insac <-themetiny(insac)                                                                                                                                                                                   
insac <- insac  + xlab("Insight report")+ylab("Accuracy")                                                                                                                                                  
dev.new(width=7*0.65,height=4*0.65)                                                                                                                                                                        
insac                                                                                                                                                                                                      
                                                                                                                                                                                                           
confac <- ggplot(aes(x=confidence_n, y=prob),data=predict_conf)+                                                                                                                                           
        geom_point(data=conf_plot,aes(y=acclogitcor, x=confidence_n),alpha=1/3, size=2,position=position_jitter(w=0.05,h=0))+                                                                              
        facet_wrap(~test_condition, ncol=1)+                                                                                                                                                               
        geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL),size=0.8)+                                                                                                                                        
        geom_line()+                                                                                                                                                                                       
        theme_classic()+                                                                                                                                                                                   
        geom_point(size=3)                                                                                                                                                                                 
confac <- mycolors(confac)                                                                                                                                                                                 
confac <-themetiny(confac)                                                                                                                                                                                 
confac <- confac +  xlab("Mean confidence rating")+ylab("Accuracy")                                                                                                                                        
confac <- confac + guides(color=guide_legend("Insight"))                                                                                                                                                   
dev.new(width=7*0.65,height=4*0.65)                                                                                                                                                                        
confac                                                                                                                                                                                                     
ggsave("conf_Test2_straight_nonplanar.pdf") 
ins_plot <- aggregate(insight~participant+number_lessons_n+math_edu_n, data=insight_bin, FUN=mean)                                                                                                         
ins_plot$inslogit <- logit(ins_plot$insight, adjust=0.01)                                                                                                                                                  
ins_plot$inscor <- ins_plot$inslogit-((ins_plot$math_edu_n)*summary(insight_lessons)$coefficients[3,1])                                                                                                    
ins_plot$inscor <- exp(ins_plot$inscor)/(1+exp(ins_plot$inscor))                                                                                                                                           
                                                                                                                                                                                                           
insight <- emmeans(insight_lessons,specs="number_lessons_n", cov.reduce=F,type="response")                                                                                                                 
predict_insight <- data.frame(summary(insight))                                                                                                                                                            
                                                                                                                                                                                                           
                                                                                                                                                                                                           
ins <- ggplot(aes(x=number_lessons_n,y=prob),data=predict_insight)+                                                                                                                                        
  geom_point(data=ins_plot,aes(y=inscor),color="grey50",alpha=1/5, size=3,position=position_jitter(w=0.3,h=0))+                                                                                            
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.8)+                                                                                                                                                                                     
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))+                                                                                                                               
  geom_point(size=3,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()                                                                                                                                                                                          
ins <- ins + ggtitle("Effect of number of lessons on insight report") + xlab("Number of lessons")+ylab("% insight reports")                                                                                
ins <- ins + guides(color=guide_legend("Number of lessons"))                                                                                                                                               
ins <- ins + theme(plot.title = element_text(face="bold",size=15,hjust = 0.5))                                                                                                                             
ins <- themetiny(ins)                                                                                                                                                                                      
ins <-mycolors(ins)                                                                                                                                                                                        
dev.new(width=7,height=4)                                                                                                                                                                                  
ins                                                                                                                                                                                                        
                                                                                                                                                                                                           
ggsave("Numb_lessons_eff_on_Insight.pdf")                                                                                                                                                                  
                                                                                                                                                                                                           
ins_plot <- aggregate(insight~participant+number_lessons_n+math_edu_n, data=insight_bin, FUN=mean)                                                                                                         
ins_plot$inslogit <- logit(ins_plot$insight, adjust=0.01)                                                                                                                                                  
ins_plot$inscor <- ins_plot$inslogit-((ins_plot$math_edu_n)*summary(insight_lessons)$coefficients[3,1])                                                                                                    
ins_plot$inscor <- exp(ins_plot$inscor)/(1+exp(ins_plot$inscor))                                                                                                                                           
                                                                                                                                                                                                           
ins_cond <- aggregate(insight~participant+number_lessons_n+math_edu_n, data=insight_bin, FUN=mean)                                                                                                         
ins_cond$inslogit <- logit(ins_cond$insight, adjust=0.01)                                                                                                                                                  
ins_cond$inscor <- ins_cond$inslogit-((ins_cond$math_edu_n)*summary(insight_lessons)$coefficients[3,1])                                                                                                    
ins_cond$inscor <- exp(ins_cond$inscor)/(1+exp(ins_cond$inscor))                                                                                                                                           
ins_cond <- aggregate(insight~participant+number_lessons_n+math_edu_n, data=insight_bin, FUN=mean)                                                                                                         
warnings()
typeof(insight_bin$insight)
mean(insight$bin$insight)
head(insigth_bin)
head(insight_bin)
insight_bin$insight=as.numeric(as.character(insight_bin$insight))
head(insight_bin)
typeof(insight_bin$insight)
ins_cond <- aggregate(insight~participant+number_lessons_n+math_edu_n, data=insight_bin, FUN=mean)         
ins_cond$inslogit <- logit(ins_cond$insight, adjust=0.01)                                    
ins_cond$inscor <- ins_cond$inslogit-((ins_cond$math_edu_n)*summary(insight_lessons)$coefficients[3,1])  
ins_cond$inscor <- ins_cond$inslogit-((ins_cond$math_edu_n)*(summary(insight_lessons)$coefficients[3,1]))
ins_cond$inscor <- ins_cond$inslogit-((ins_cond$math_edu_n)*(summary(insight_lessons)$coefficients[3,1]))
(summary(insight_lessons)$coefficients[3,1])
summary(insight_lessons)$coefficients[3,1]
summary(insight_lessons)$coefficients
summary(insight_lessons)
insight_lessons
insight_lessons <- glm(insight~number_lessons_n+math_edu_n, data=insight_bin,family=binomial)                                                                                                              
Anova(insight_lessons, type="III")                                                                                                                                                                         
summary(insight_lessons)
summary(insight_lessons)$coefficients
summary(insight_lessons)$coefficients[3,1]
insight_bin$insight=as.numeric(as.character(insight_bin$insight))                                                                                                                                          
ins_cond <- aggregate(insight~participant+number_lessons_n+math_edu_n, data=insight_bin, FUN=mean)                                                                                                         
ins_cond$inslogit <- logit(ins_cond$insight, adjust=0.01)                                                                                                                                                  
ins_cond$inscor <- ins_cond$inslogit-((ins_cond$math_edu_n)*(summary(insight_lessons)$coefficients[3,1]))                                                                                                  
ins_cond$inscor <- exp(ins_cond$inscor)/(1+exp(ins_cond$inscor))                                                                                                                                           
                                                                                                                                                                                                           
insight <- emmeans(insight_lessons,specs="number_lessons_n", cov.reduce=F,type="response")                                                                                                                 
predict_insight <- data.frame(summary(insight))                                                                                                                                                            
                                                                                                                                                                                                           
                                                                                                                                                                                                           
ins <- ggplot(aes(x=number_lessons_n,y=prob),data=predict_insight)+                                                                                                                                        
  geom_point(data=ins_cond,aes(y=inscor),color="grey50",alpha=1/5, size=3,position=position_jitter(w=0.3,h=0))+                                                                                            
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.8)+                                                                                                                                                                                     
  scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))+                                                                                                                               
  geom_point(size=3,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()                                                                                                                                                                                          
ins <- ins + ggtitle("Effect of number of lessons on insight report") + xlab("Number of lessons")+ylab("% insight reports")                                                                                
ins <- ins + guides(color=guide_legend("Number of lessons"))                                                                                                                                               
ins <- ins + theme(plot.title = element_text(face="bold",size=15,hjust = 0.5))                                                                                                                             
ins <- themetiny(ins)                                                                                                                                                                                      
ins <-mycolors(ins)                                                                                                                                                                                        
dev.new(width=7,height=4)                                                                                                                                                                                  
ins                                                                                                                                                                                                        
ins <- ggplot(aes(x=number_lessons_n,y=prob),data=predict_insight)+                                                                                                                                        
  geom_point(data=ins_cond,aes(y=inscor),color="grey50",alpha=1/5, size=3,position=position_jitter(w=0.3,h=0))+                                                                                            
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.8)+                                                                                                                                                                                     
  ## scale_x_discrete(breaks=c(1,3,5,7),limits=c("1","", "3", "","5", "","7"))+                                                                                                                            
  geom_point(size=3,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()                                                                                                                                                                                          
ins <- ins + ggtitle("Effect of number of lessons on insight report") + xlab("Number of lessons")+ylab("% insight reports")                                                                                
ins <- ins + guides(color=guide_legend("Number of lessons"))                                                                                                                                               
ins <- ins + theme(plot.title = element_text(face="bold",size=15,hjust = 0.5))                                                                                                                             
ins <- themetiny(ins)                                                                                                                                                                                      
ins <-mycolors(ins)                                                                                                                                                                                        
dev.new(width=7,height=4)                                                                                                                                                                                  
ins                                                                                                                                                                                                        
ggsave("Numb_lessons_eff_on_Insight.pdf")  
lessons_perf_plot <- mixed(acc~number_lessons_n*test_condition+math_edu_n*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=F, method="LRT")                                      
                                                                                                                                                                                                           
## No need to set level of math edu here, emmeans already sets at mean level in  model                                                                                                                     
predictions <- data.frame(emmeans(lessons_perf_plot,specs=c("number_lessons_n","test_condition"), cov.reduce=F, type="response"))                                                                          
                                                                                                                                                                                                           
predictions$test_condition= factor(predictions$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                     
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar', 'Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                          
predictions=predictions[order(predictions$test_condition),]                                                                                                                                                
summary(lessons_perf_cov_plot)$coefficients
summary(lessons_perf_plot)$coefficients
all_plot=aggregate(acc~participant+number_lessons_n+test_condition+math_edu_n, data=tests, FUN=mean)                                                                                                       
all_plot$acclogit=logit(all_plot$acc, adjust=0.01)   
all_plot$acclogit=logit(all_plot$acc, adjust=0.01)[11,1]
summary(lessons_perf_plot)$coefficients[11,1]
all_plot=aggregate(acc~participant+number_lessons_n+test_condition+math_edu_n, data=tests, FUN=mean)                                                                                                       
all_plot$acclogit=logit(all_plot$acc, adjust=0.01)                                                                                                                                                         
all_plot$acclogitcor=all_plot$acclogit-((all_plot$math_edu_n)*(summary(lessons_perf_plot)$coefficients[11,1]))                                                                                             
all_plot$coeffniv[all_plot$test_condition=="Test1_great_circles"]=0                                                                                                                                        
all_plot$coeffniv[all_plot$test_condition=="Test1_non_circles"]=summary(lessons_perf_plot)$coefficients[20,1]                                                                                              
all_plot$coeffniv[all_plot$test_condition=="Test1_small_circles"]=summary(lessons_perf_plot)$coefficients[21,1]                                                                                            
all_plot$coeffniv[all_plot$test_condition=="Test2_nonstraight_nonplanar"]=summary(lessons_perf_plot)$coefficients[22,1]                                                                                    
all_plot$coeffniv[all_plot$test_condition=="Test2_nonstraight_planar"]=summary(lessons_perf_plot)$coefficients[23,1]                                                                                       
all_plot$coeffniv[all_plot$test_condition=="Test2_straight_nonplanar"]=summary(lessons_perf_plot)$coefficients[24,1]                                                                                       
all_plot$coeffniv[all_plot$test_condition=="Test2_straight_planar"]=summary(lessons_perf_plot)$coefficients[25,1]                                                                                          
all_plot$coeffniv[all_plot$test_condition=="Test3_sphere"]=summary(lessons_perf_plot)$coefficients[27,1]                                                                                                   
all_plot$coeffniv[all_plot$test_condition=="Test3_other_surfaces"]=summary(lessons_perf_plot)$coefficients[26,1]                                                                                           
all_plot$acclogitcor=all_plot$acclogitcor-((all_plot$math_edu_n)*all_plot$coeffniv)                                                                                                                        
all_plot$acclogitcor=exp(all_plot$acclogitcor)/(1+exp(all_plot$acclogitcor))                                                                                                                               
                                                                                                                                                                                                           
                                                                                                                                                                                                           
all_plot$test_condition= factor(all_plot$test_condition, levels=c('Test1_non_circles','Test1_great_circles','Test1_small_circles','Test2_nonstraight_nonplanar',                                           
'Test2_straight_planar','Test2_nonstraight_planar','Test2_straight_nonplanar','Test3_sphere', 'Test3_other_surfaces'), order=T )                                                                           
all_plot=all_plot[order(all_plot$test_condition),]                                                                                                                                                         
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  ## scale_x_discrete(breaks=c(1,3,5,7),limits=c("-4","", "-1", "","1", ""))                                                                                                                               
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
                                                                                                                                                                                                           
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles")                                                                                                                             
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)+                                                                                                                                                                                 
  ## scale_x_discrete(breaks=c(1,3,5,7),limits=c("-4","", "-1", "","1", ""))                                                                                                                               
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
                                                                                                                                                                                                           
head(predictions)
condtest1 = c("Test1_non_circles","Test1_small_circles","Test1_great_circles") 
perf_test1 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest1))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest1),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid(. ~ test_condition)+                                                                                                                                                                          
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)                                                                                                                                                                                  
  ## scale_x_discrete(breaks=c(1,3,5,7),limits=c("-4","", "-1", "","1", ""))                                                                                                                               
perf_test1 <- perf_test1 + ggtitle("Effect of the number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                             
perf_test1 <- perf_test1 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test1 <-mycolors(perf_test1)                                                                                                                                                                          
perf_test1 <-themetiny(perf_test1)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test1                                                                                                                                                                                                 
ggsave("number_lessons_on_perf_test1_newplot.pdf")    
condtest2 = c("Test2_nonstraight_nonplanar","Test2_straight_planar","Test2_nonstraight_planar","Test2_straight_nonplanar")                                                                                 
perf_test2 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest2))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest2),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid( . ~ test_condition)+                                                                                                                                                                         
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)                                                                                                                                                                                  
perf_test2 <- perf_test2 + ggtitle("Effect of number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                                 
perf_test2 <- perf_test2 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test2 <-mycolors(perf_test2)                                                                                                                                                                          
perf_test2 <-themetiny(perf_test2)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test2                                                                                                                                                                                                 
                                                                                                                                                                                                           
ggsave("number_lessons_on_perf_test2.pdf")                                                                                                                                                                 
                                                                                                                                                                                                           
condtest3 = c("Test3_sphere","Test3_other_surfaces")                                                                                                                                                       
perf_test3 <- ggplot(aes(x=number_lessons_n,y=prob),data=subset(predictions,test_condition%in%condtest3))+                                                                                                 
  geom_point(data=subset(all_plot,test_condition%in%condtest3),aes(y=acclogitcor),  color="grey50",alpha=1/5, size=2,position=position_jitter(w=0.3,h=0))+                                                 
  geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL,color=factor(number_lessons_n)),size=0.8)+                                                                                                               
  geom_line(size=0.5)+                                                                                                                                                                                     
  facet_grid( . ~ test_condition)+                                                                                                                                                                         
  geom_point(size=2,aes(color=factor(number_lessons_n)))+                                                                                                                                                  
  theme_classic()+                                                                                                                                                                                         
  theme(aspect.ratio=2.5)                                                                                                                                                                                  
                                                                                                                                                                                                           
                                                                                                                                                                                                           
perf_test3 <- perf_test3 + ggtitle("Effect of number of lessons on accuracy") + xlab("Number of lessons")+ylab("Accuracy")                                                                                 
perf_test3 <- perf_test3 + guides(color=guide_legend("Number of lessons"))                                                                                                                                 
perf_test3 <-mycolors(perf_test3)                                                                                                                                                                          
perf_test3 <-themetiny(perf_test3)                                                                                                                                                                         
dev.new(width=10,height=4)                                                                                                                                                                                 
perf_test3                                                                                                                                                                                                 
ggsave("number_lessons_on_perf_test3.pdf")    
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
lessons_perf  
perf_confs_cov
perf_confs
perf_confs <- mixed(acc~test_condition*insight + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,check_contrasts=T,method="LRT")                                         
summary(perf_confs)                                                                                                                                                                                        
perf_confs
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, included==1 & number_lessons!=0)                                                                                                                                                    
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, included==1 & number_lessons!=0)                                                                                                                                          
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
insight <- read.table("insight_moments.csv", sep = ";", header=T)                                                                                                                                          
insight <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                                
insight_bin <- read.table("insight_binary.csv", sep=";", header=T)                                                                                                                                         
insight_bin <- subset(insight_bin, included==1 & number_lessons!=0)                                                                                                                                        
insight_bin$insight <- as.factor(insight_bin$insight)                                                                                                                                                      
                                                                                                                                                                                                           
###### insight during teaching phase                                                                                                                                                                       
insight_teach <- read.table("insight_lessons.csv", sep=";", header=T)                                                                                                                                      
insight_teach <- subset(insight_teach, included==1 & number_lessons!=0)                                                                                                                                    
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights during learning sessions+tests (everything except pre tests)                                                                                                                                 
insights_post <- subset(insight, included==1 & number_lessons!=0)                                                                                                                                          
insights_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                         
insights_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=insights_post, FUN=max)                                                                                     
insights_post$insight <- insights_post$response                                                                                                                                                            
insights_post$response <- NULL                                                                                                                                                                             
tests$number_lessons_n <- scale(tests$number_lessons, center=TRUE, scale=FALSE)                                                                                                                            
tests$math_edu_n <- scale(tests$math_edu, center=TRUE, scale=FALSE)                                                                                                                                        
                                                                                                                                                                                                           
insight_bin$number_lessons_n <- scale(insight_bin$number_lessons, center=TRUE, scale=FALSE)                                                                                                                
insight_bin$math_edu_n <- scale(insight_bin$math_edu, center=TRUE, scale=FALSE)                                                                                                                            
                                                                                                                                                                                                           
confidence$number_lessons_n <- scale(confidence$number_lessons, center=TRUE, scale=FALSE)                                                                                                                  
confidence$math_edu_n <- scale(confidence$math_edu, center=TRUE, scale=FALSE)                                                                                                                              
confidence$confidence_n <- scale(confidence$confidence, center=TRUE, scale=FALSE)                                                                                                                          
conf_mean$number_lessons_n <- scale(conf_mean$number_lessons, center=TRUE, scale=FALSE)                                                                                                                    
conf_mean$confidence_n <- scale(conf_mean$confidence, center=T, scale=F)                                                                                                                                   
conf_mean$math_edu_n <- scale(conf_mean$math_edu, center=TRUE, scale=FALSE)                                                                                                                                
#### data frames merging data about insight, confidence and performance                                                                                                                                    
conf_perf <- merge(tests, conf_mean)                                                                                                                                                                       
insight_perf <- merge(tests,insight_bin)                                                                                                                                                                   
insight_perf$insight <- as.factor(insight_perf$insight)                                                                                                                                                    
confmeaninsight <- merge(conf_perf, insight_bin)                                                                                                                                                           
confmeaninsight$insight <- as.factor(confmeaninsight$insight)                                                                                                                                              
perf_confs <- mixed(acc~test_condition*insight + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,check_contrasts=T,method="LRT")    
perf_confs
perf_ins_cov_bef   
perf_confs_cov 
perf_confs_cov <- mixed(acc~test_condition*number_lessons_n+test_condition*insight+math_edu_n*test_condition + confidence_n*test_condition+(1|participant), data=confmeaninsight,family=binomial,          
check_contrasts=T,method="LRT")                                                                                                                                                                            
summary(perf_confs_cov)                                                                                                                                                                                    
perf_confs_cov
quit()
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
confac <- ggplot(aes(x=confidence_n, y=prob),data=predict_conf)+                                                                                                                                           
        geom_point(data=conf_plot,aes(y=acclogitcor, x=confidence_n),alpha=1/3, size=2,position=position_jitter(w=0.05,h=0))+                                                                              
        facet_wrap(~test_condition, ncol=1)+                                                                                                                                                               
        geom_errorbar(aes(ymin=asymp.LCL,ymax=asymp.UCL),size=0.8)+                                                                                                                                        
        geom_line()+                                                                                                                                                                                       
        theme_classic()+                                                                                                                                                                                   
        geom_point(size=3)                                                                                                                                                                                 
confac <- mycolors(confac)                                                                                                                                                                                 
confac <-themetiny(confac)                                                                                                                                                                                 
confac <- confac +  xlab("Mean confidence rating")+ylab("Accuracy")                                                                                                                                        
confac <- confac + guides(color=guide_legend("Insight"))                                                                                                                                                   
dev.new(width=7*0.65,height=4*0.65)                                                                                                                                                                        
confac                                                                                                                                                                                                     
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0) # use this to exclude the participants who did not receive any lessons (main analyses)                                                             
# parts <- subset(parts, included==1) # use this instead to include the participants who did not receive any lessons (supplementary analyses)                                                              
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, participant%in%parts$participant)                                                                                                                                                   
tests$test_condition <- relevel(as.factor(tests$test_condition), ref="Test1_non_circles")                                                                                                                  
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, participant%in%parts$participant)                                                                                                                                         
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
Eureka <- read.table("Eureka_moments.csv", sep = ";", header=T)                                                                                                                                            
Eureka <- subset(Eureka, participant%in%parts$participant)                                                                                                                                                 
Eureka_bin <- read.table("Eureka_binary.csv", sep=";", header=T)                                                                                                                                           
Eureka_bin <- subset(Eureka_bin, participant%in%parts$participant)                                                                                                                                         
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0) # use this to exclude the participants who did not receive any lessons (main analyses)                                                             
# parts <- subset(parts, included==1) # use this instead to include the participants who did not receive any lessons (supplementary analyses)                                                              
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, participant%in%parts$participant)                                                                                                                                                   
tests$test_condition <- relevel(as.factor(tests$test_condition), ref="Test1_non_circles")   
lessons_perf <- mixed(acc~number_lessons*test_condition+math_edu*test_condition+(1|participant), data=tests,family=binomial,check_contrasts=FALSE,method="LRT")                                            
lessons_perf                                                                                                                                                                                               
summary(tests)
summary(insight_moments)
summary(insight)
library(afex)                                                                                                                                                                                              
library(emmeans)                                                                                                                                                                                           
library(ppcor)                                                                                                                                                                                             
library(car)                                                                                                                                                                                               
library(ggplot2)                                                                                                                                                                                           
library(reshape2)                                                                                                                                                                                          
                                                                                                                                                                                                           
                                                                                                                                                                                                           
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0) # use this to exclude the participants who did not receive any lessons (main analyses)                                                             
# parts <- subset(parts, included==1) # use this instead to include the participants who did not receive any lessons (supplementary analyses)                                                              
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, participant%in%parts$participant)                                                                                                                                                   
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, participant%in%parts$participant)                                                                                                                                         
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
eureka <- read.table("eureka_moments.csv", sep = ";", header=T)                                                                                                                                            
eureka <- subset(Eureka, participant%in%parts$participant)                                                                                                                                                 
eureka_bin <- read.table("eureka_binary.csv", sep=";", header=T)                                                                                                                                           
eureka_bin <- subset(eureka_bin, participant%in%parts$participant)                                                                                                                                         
                                                                                                                                                                                                           
#### A RENOMMER                                                                                                                                                                                            
###### insight during teaching phase                                                                                                                                                                       
eureka_teach <- read.table("eureka_lessons.csv", sep=";", header=T)                                                                                                                                        
eureka_teach <- subset(eureka_teach, participant%in%parts$participant)                                                                                                                                     
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights during learning sessions+tests (everything except pre tests)                                                                                                                                 
eureka_post <- subset(eureka, participant%in%parts$participant)                                                                                                                                            
eureka_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                           
eureka_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=eureka_post, FUN=max)                                                                                         
eureka_post$eureka <- eureka_post$response                                                                                                                                                                 
eureka_post$response <- NULL                                                                                                                                                                               
parts <- read.table("participants.csv", sep=";", header=T, dec=",")                                                                                                                                        
parts <- subset(parts, included==1 & number_lessons!=0) # use this to exclude the participants who did not receive any lessons (main analyses)                                                             
# parts <- subset(parts, included==1) # use this instead to include the participants who did not receive any lessons (supplementary analyses)                                                              
                                                                                                                                                                                                           
tests <- read.table("tests.csv", sep=";", header=T, dec=",")                                                                                                                                               
tests <- subset(tests, participant%in%parts$participant)                                                                                                                                                   
                                                                                                                                                                                                           
confidence <- read.table("confidence_ratings.csv", sep=";", header=T, dec=",")                                                                                                                             
confidence <- subset(confidence, participant%in%parts$participant)                                                                                                                                         
conf_mean <- aggregate(confidence~participant+number_lessons+math_edu+included, data=confidence, FUN=mean)                                                                                                 
                                                                                                                                                                                                           
eureka <- read.table("eureka_moments.csv", sep = ";", header=T)                                                                                                                                            
eureka <- subset(eureka, participant%in%parts$participant)                                                                                                                                                 
eureka_bin <- read.table("eureka_binary.csv", sep=";", header=T)                                                                                                                                           
eureka_bin <- subset(eureka_bin, participant%in%parts$participant)                                                                                                                                         
                                                                                                                                                                                                           
#### A RENOMMER                                                                                                                                                                                            
###### insight during teaching phase                                                                                                                                                                       
eureka_teach <- read.table("eureka_lessons.csv", sep=";", header=T)                                                                                                                                        
eureka_teach <- subset(eureka_teach, participant%in%parts$participant)                                                                                                                                     
                                                                                                                                                                                                           
                                                                                                                                                                                                           
#### insights during learning sessions+tests (everything except pre tests)                                                                                                                                 
eureka_post <- subset(eureka, participant%in%parts$participant)                                                                                                                                            
eureka_post <- subset(insight, !position%in%c("straight_lines_on_spheres1", "planar_geometry" ))                                                                                                           
eureka_post <- aggregate(response~participant+included+number_lessons+math_edu+lessons, data=eureka_post, FUN=max)                                                                                         
eureka_post$eureka <- eureka_post$response                                                                                                                                                                 
eureka_post$response <- NULL                                                                                                                                                                               
                                                                                                                                                                                                           
                                                                                                                                                                                                           
                                                                                                                                                                                                           
table(subset(Eureka,response==1)$position)  
table(subset(eureka,response==1)$position)  
table(subset(eureka,response==1 & included==1)$position)  
summary(eureka_bin)
quit()
summary(parts)
quit()
